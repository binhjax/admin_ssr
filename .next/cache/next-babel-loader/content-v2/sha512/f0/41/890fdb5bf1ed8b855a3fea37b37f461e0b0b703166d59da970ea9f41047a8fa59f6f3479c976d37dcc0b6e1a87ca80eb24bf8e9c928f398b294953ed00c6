{"ast":null,"code":"import \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/popconfirm/style\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport \"antd/lib/divider/style\";\nimport _Divider from \"antd/lib/divider\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/nguyenthanhbinh/Work/vnshop/admin/src/pages/menu/MenuAction/index.js\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { PureComponent } from 'react';\nimport { newUUID } from '@/utils/utils';\nimport FormDialog from './FormDialog';\nimport TplDialog from './TplDialog';\nimport styles from './index.less';\n\nfunction fillKey(data) {\n  if (!data) {\n    return [];\n  }\n\n  return data.map(function (item) {\n    var nitem = _objectSpread({}, item);\n\n    if (!nitem.key) {\n      nitem.key = newUUID();\n    }\n\n    return nitem;\n  });\n}\n\nvar MenuAction = /*#__PURE__*/function (_PureComponent) {\n  _inherits(MenuAction, _PureComponent);\n\n  var _super = _createSuper(MenuAction);\n\n  function MenuAction() {\n    var _this;\n\n    _classCallCheck(this, MenuAction);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      dataSource: [],\n      formVisible: false,\n      formData: {},\n      tplVisible: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDelete\", function (key) {\n      var dataSource = _this.state.dataSource;\n      var data = dataSource.filter(function (item) {\n        return item.key !== key;\n      });\n\n      _this.setState({\n        dataSource: data\n      }, function () {\n        _this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleEdit\", function (item) {\n      _this.setState({\n        formVisible: true,\n        formData: item\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleFormCancel\", function () {\n      _this.setState({\n        formVisible: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleFormSubmit\", function (formData) {\n      var dataSource = _this.state.dataSource;\n\n      var data = _toConsumableArray(dataSource);\n\n      var exists = false;\n\n      for (var i = 0; i < data.length; i += 1) {\n        if (data[i].code === formData.code) {\n          exists = true;\n          data[i] = _objectSpread({\n            key: formData.code\n          }, formData);\n          break;\n        }\n      }\n\n      if (!exists) {\n        data.push(_objectSpread({\n          key: formData.code\n        }, formData));\n      }\n\n      _this.setState({\n        dataSource: data,\n        formVisible: false\n      }, function () {\n        _this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAdd\", function () {\n      _this.setState({\n        formVisible: true,\n        formData: {}\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleTplCancel\", function () {\n      _this.setState({\n        tplVisible: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleTplSubmit\", function (formData) {\n      var path = formData.path;\n      var tplData = [{\n        code: 'add',\n        name: '新增',\n        resources: [{\n          method: 'POST',\n          path: path\n        }]\n      }, {\n        code: 'edit',\n        name: '编辑',\n        resources: [{\n          method: 'GET',\n          path: \"\".concat(path, \"/:id\")\n        }, {\n          method: 'PUT',\n          path: \"\".concat(path, \"/:id\")\n        }]\n      }, {\n        code: 'del',\n        name: '删除',\n        resources: [{\n          method: 'DELETE',\n          path: \"\".concat(path, \"/:id\")\n        }]\n      }, {\n        code: 'view',\n        name: '查看',\n        resources: [{\n          method: 'GET',\n          path: \"\".concat(path, \"/:id\")\n        }]\n      }, {\n        code: 'query',\n        name: '查询',\n        resources: [{\n          method: 'GET',\n          path: path\n        }]\n      }];\n      var newData = tplData.map(function (v) {\n        return _objectSpread({\n          key: v.code\n        }, v);\n      });\n      var dataSource = _this.state.dataSource;\n\n      var data = _toConsumableArray(dataSource);\n\n      var mDataSource = data.reduce(function (m, cur) {\n        var nm = _objectSpread({}, m);\n\n        nm[cur.code] = cur;\n        return nm;\n      }, {});\n\n      for (var i = 0; i < newData.length; i += 1) {\n        if (!mDataSource[newData[i].key]) {\n          data.push(_objectSpread({}, newData[i]));\n        }\n      }\n\n      _this.setState({\n        dataSource: data,\n        tplVisible: false\n      }, function () {\n        _this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleTplAdd\", function () {\n      _this.setState({\n        tplVisible: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSave\", function (row) {\n      var dataSource = _this.state.dataSource;\n\n      var data = _toConsumableArray(dataSource);\n\n      var index = data.findIndex(function (item) {\n        return row.key === item.key;\n      });\n      var item = data[index];\n      data.splice(index, 1, _objectSpread(_objectSpread({}, item), row));\n\n      _this.setState({\n        dataSource: data\n      }, function () {\n        _this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"triggerChange\", function (data) {\n      var onChange = _this.props.onChange;\n\n      if (onChange) {\n        onChange(data);\n      }\n    });\n\n    return _this;\n  }\n\n  _createClass(MenuAction, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          dataSource = _this$state.dataSource,\n          tplVisible = _this$state.tplVisible,\n          formData = _this$state.formData,\n          formVisible = _this$state.formVisible;\n      var columns = [{\n        title: '动作编号',\n        dataIndex: 'code',\n        width: '35%'\n      }, {\n        title: '动作名称',\n        dataIndex: 'name',\n        width: '35%'\n      }, {\n        title: '操作',\n        dataIndex: 'key',\n        width: '30%',\n        render: function render(_, record) {\n          return [__jsx(\"a\", {\n            href: \"#\",\n            onClick: function onClick() {\n              return _this2.handleEdit(record);\n            },\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 13\n            }\n          }, \"\\u7F16\\u8F91\"), __jsx(_Divider, {\n            type: \"vertical\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 190,\n              columnNumber: 13\n            }\n          }), __jsx(_Popconfirm, {\n            title: \"\\u786E\\u5B9A\\u8981\\u5220\\u9664\\u8BE5\\u6570\\u636E\\u5417?\",\n            onConfirm: function onConfirm() {\n              return _this2.handleDelete(record.key);\n            },\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 191,\n              columnNumber: 13\n            }\n          }, __jsx(\"a\", {\n            href: \"#\",\n            __self: _this2,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 15\n            }\n          }, \"\\u5220\\u9664\"))];\n        }\n      }];\n      return __jsx(\"div\", {\n        className: styles.tableList,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 7\n        }\n      }, __jsx(\"div\", {\n        className: styles.tableListOperator,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 9\n        }\n      }, __jsx(_Button, {\n        onClick: this.handleAdd,\n        size: \"small\",\n        type: \"primary\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 11\n        }\n      }, \"\\u65B0\\u589E\"), __jsx(_Button, {\n        onClick: this.handleTplAdd,\n        size: \"small\",\n        type: \"primary\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 11\n        }\n      }, \"\\u5FEB\\u901F\\u6A21\\u677F\")), __jsx(_Table, {\n        rowKey: function rowKey(record) {\n          return record.key;\n        },\n        bordered: true,\n        dataSource: dataSource,\n        columns: columns,\n        pagination: false,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 9\n        }\n      }), __jsx(TplDialog, {\n        visible: tplVisible,\n        onSubmit: this.handleTplSubmit,\n        onCancel: this.handleTplCancel,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 9\n        }\n      }), __jsx(FormDialog, {\n        visible: formVisible,\n        formData: formData,\n        onSubmit: this.handleFormSubmit,\n        onCancel: this.handleFormCancel,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 9\n        }\n      }));\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(nextProps, state) {\n      if ('value' in nextProps) {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          dataSource: fillKey(nextProps.value)\n        });\n      }\n\n      return state;\n    }\n  }]);\n\n  return MenuAction;\n}(PureComponent);\n\nexport { MenuAction as default };","map":{"version":3,"sources":["/Users/nguyenthanhbinh/Work/vnshop/admin/src/pages/menu/MenuAction/index.js"],"names":["React","PureComponent","newUUID","FormDialog","TplDialog","styles","fillKey","data","map","item","nitem","key","MenuAction","dataSource","formVisible","formData","tplVisible","state","filter","setState","triggerChange","exists","i","length","code","push","path","tplData","name","resources","method","newData","v","mDataSource","reduce","m","cur","nm","row","index","findIndex","splice","onChange","props","columns","title","dataIndex","width","render","_","record","handleEdit","handleDelete","tableList","tableListOperator","handleAdd","handleTplAdd","handleTplSubmit","handleTplCancel","handleFormSubmit","handleFormCancel","nextProps","value"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\r\nimport { Table, Button, Popconfirm, Divider } from 'antd';\r\nimport { newUUID } from '@/utils/utils';\r\nimport FormDialog from './FormDialog';\r\nimport TplDialog from './TplDialog';\r\nimport styles from './index.less';\r\n\r\n\r\n\r\nfunction fillKey(data) {\r\n  if (!data) {\r\n    return [];\r\n  }\r\n  return data.map(item => {\r\n    const nitem = { ...item };\r\n    if (!nitem.key) {\r\n      nitem.key = newUUID();\r\n    }\r\n    return nitem;\r\n  });\r\n}\r\n\r\nexport default class MenuAction extends PureComponent {\r\n  state = {\r\n    dataSource: [],\r\n    formVisible: false,\r\n    formData: {},\r\n    tplVisible: false,\r\n  };\r\n\r\n  static getDerivedStateFromProps(nextProps, state) {\r\n    if ('value' in nextProps) {\r\n      return {\r\n        ...state,\r\n        dataSource: fillKey(nextProps.value),\r\n      };\r\n    }\r\n    return state;\r\n  }\r\n\r\n  handleDelete = key => {\r\n    const { dataSource } = this.state;\r\n    const data = dataSource.filter(item => item.key !== key);\r\n    this.setState({ dataSource: data }, () => {\r\n      this.triggerChange(data);\r\n    });\r\n  };\r\n\r\n  handleEdit = item => {\r\n    this.setState({\r\n      formVisible: true,\r\n      formData: item,\r\n    });\r\n  };\r\n\r\n  handleFormCancel = () => {\r\n    this.setState({ formVisible: false });\r\n  };\r\n\r\n  handleFormSubmit = formData => {\r\n    const { dataSource } = this.state;\r\n    const data = [...dataSource];\r\n    let exists = false;\r\n    for (let i = 0; i < data.length; i += 1) {\r\n      if (data[i].code === formData.code) {\r\n        exists = true;\r\n        data[i] = { key: formData.code, ...formData };\r\n        break;\r\n      }\r\n    }\r\n    if (!exists) {\r\n      data.push({ key: formData.code, ...formData });\r\n    }\r\n    this.setState({ dataSource: data, formVisible: false }, () => {\r\n      this.triggerChange(data);\r\n    });\r\n  };\r\n\r\n  handleAdd = () => {\r\n    this.setState({ formVisible: true, formData: {} });\r\n  };\r\n\r\n  handleTplCancel = () => {\r\n    this.setState({ tplVisible: false });\r\n  };\r\n\r\n  handleTplSubmit = formData => {\r\n    const { path } = formData;\r\n    const tplData = [\r\n      {\r\n        code: 'add',\r\n        name: '新增',\r\n        resources: [{ method: 'POST', path }],\r\n      },\r\n      {\r\n        code: 'edit',\r\n        name: '编辑',\r\n        resources: [{ method: 'GET', path: `${path}/:id` }, { method: 'PUT', path: `${path}/:id` }],\r\n      },\r\n      {\r\n        code: 'del',\r\n        name: '删除',\r\n        resources: [{ method: 'DELETE', path: `${path}/:id` }],\r\n      },\r\n      {\r\n        code: 'view',\r\n        name: '查看',\r\n        resources: [{ method: 'GET', path: `${path}/:id` }],\r\n      },\r\n      {\r\n        code: 'query',\r\n        name: '查询',\r\n        resources: [{ method: 'GET', path }],\r\n      },\r\n    ];\r\n\r\n    const newData = tplData.map(v => ({ key: v.code, ...v }));\r\n    const { dataSource } = this.state;\r\n    const data = [...dataSource];\r\n    const mDataSource = data.reduce((m, cur) => {\r\n      const nm = { ...m };\r\n      nm[cur.code] = cur;\r\n      return nm;\r\n    }, {});\r\n    for (let i = 0; i < newData.length; i += 1) {\r\n      if (!mDataSource[newData[i].key]) {\r\n        data.push({ ...newData[i] });\r\n      }\r\n    }\r\n\r\n    this.setState(\r\n      {\r\n        dataSource: data,\r\n        tplVisible: false,\r\n      },\r\n      () => {\r\n        this.triggerChange(data);\r\n      }\r\n    );\r\n  };\r\n\r\n  handleTplAdd = () => {\r\n    this.setState({ tplVisible: true });\r\n  };\r\n\r\n  handleSave = row => {\r\n    const { dataSource } = this.state;\r\n    const data = [...dataSource];\r\n    const index = data.findIndex(item => row.key === item.key);\r\n    const item = data[index];\r\n    data.splice(index, 1, {\r\n      ...item,\r\n      ...row,\r\n    });\r\n    this.setState({ dataSource: data }, () => {\r\n      this.triggerChange(data);\r\n    });\r\n  };\r\n\r\n  triggerChange = data => {\r\n    const { onChange } = this.props;\r\n    if (onChange) {\r\n      onChange(data);\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { dataSource, tplVisible, formData, formVisible } = this.state;\r\n\r\n    const columns = [\r\n      {\r\n        title: '动作编号',\r\n        dataIndex: 'code',\r\n        width: '35%',\r\n      },\r\n      {\r\n        title: '动作名称',\r\n        dataIndex: 'name',\r\n        width: '35%',\r\n      },\r\n      {\r\n        title: '操作',\r\n        dataIndex: 'key',\r\n        width: '30%',\r\n        render: (_, record) => {\r\n          return [\r\n            <a href=\"#\" onClick={() => this.handleEdit(record)}>\r\n              编辑\r\n            </a>,\r\n            <Divider type=\"vertical\" />,\r\n            <Popconfirm title=\"确定要删除该数据吗?\" onConfirm={() => this.handleDelete(record.key)}>\r\n              <a href=\"#\">删除</a>\r\n            </Popconfirm>,\r\n          ];\r\n        },\r\n      },\r\n    ];\r\n\r\n    return (\r\n      <div className={styles.tableList}>\r\n        <div className={styles.tableListOperator}>\r\n          <Button onClick={this.handleAdd} size=\"small\" type=\"primary\">\r\n            新增\r\n          </Button>\r\n          <Button onClick={this.handleTplAdd} size=\"small\" type=\"primary\">\r\n            快速模板\r\n          </Button>\r\n        </div>\r\n        <Table\r\n          rowKey={record => record.key}\r\n          bordered\r\n          dataSource={dataSource}\r\n          columns={columns}\r\n          pagination={false}\r\n        />\r\n        <TplDialog\r\n          visible={tplVisible}\r\n          onSubmit={this.handleTplSubmit}\r\n          onCancel={this.handleTplCancel}\r\n        />\r\n        <FormDialog\r\n          visible={formVisible}\r\n          formData={formData}\r\n          onSubmit={this.handleFormSubmit}\r\n          onCancel={this.handleFormCancel}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}