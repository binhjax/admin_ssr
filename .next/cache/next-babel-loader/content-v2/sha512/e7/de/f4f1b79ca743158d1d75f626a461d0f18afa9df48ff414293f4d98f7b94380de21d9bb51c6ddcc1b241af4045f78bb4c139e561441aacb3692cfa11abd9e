{"ast":null,"code":"import \"antd/lib/card/style\";\nimport _Card from \"antd/lib/card\";\nimport \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/layout/style\";\nimport _Layout from \"antd/lib/layout\";\nimport \"antd/lib/badge/style\";\nimport _Badge from \"antd/lib/badge\";\nimport \"antd/lib/row/style\";\nimport _Row from \"antd/lib/row\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/col/style\";\nimport _Col from \"antd/lib/col\";\nimport \"antd/lib/input/style\";\nimport _Input from \"antd/lib/input\";\nimport \"antd/lib/tree/style\";\nimport _Tree from \"antd/lib/tree\";\nimport \"antd/lib/modal/style\";\nimport _Modal from \"antd/lib/modal\";\n\nvar _dec, _class, _temp;\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { PureComponent } from 'react';\nimport { Form } from '@ant-design/compatible';\nimport '@ant-design/compatible/assets/index.css';\nimport PageHeaderLayout from '@/layouts/PageHeaderLayout';\nimport PButton from '@/components/PermButton';\nimport { formatDate } from '@/utils/utils';\nimport MenuCard from '../../components/Menu/MenuCard';\nimport WithDva from '../../utils/store';\nimport styles from './menu.less'; // @connect(({ menu, loading }) => ({\n//   menu,\n//   loading: loading.models.menu,\n// }))\n\nlet MenuList = (_dec = Form.create(), _dec(_class = (_temp = class MenuList extends PureComponent {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      selectedRowKeys: [],\n      selectedRows: [],\n      treeSelectedKeys: []\n    });\n\n    _defineProperty(this, \"onItemDisableClick\", item => {\n      this.dispatch({\n        type: 'menu/changeStatus',\n        payload: {\n          id: item.id,\n          status: 2\n        }\n      });\n    });\n\n    _defineProperty(this, \"onItemEnableClick\", item => {\n      this.dispatch({\n        type: 'menu/changeStatus',\n        payload: {\n          id: item.id,\n          status: 1\n        }\n      });\n    });\n\n    _defineProperty(this, \"handleEditClick\", () => {\n      const {\n        selectedRows\n      } = this.state;\n\n      if (selectedRows.length === 0) {\n        return;\n      }\n\n      const item = selectedRows[0];\n      this.dispatch({\n        type: 'menu/loadForm',\n        payload: {\n          type: 'E',\n          id: item.id\n        }\n      });\n    });\n\n    _defineProperty(this, \"handleAddClick\", () => {\n      this.dispatch({\n        type: 'menu/loadForm',\n        payload: {\n          type: 'A'\n        }\n      });\n    });\n\n    _defineProperty(this, \"handleDelClick\", () => {\n      const {\n        selectedRows\n      } = this.state;\n\n      if (selectedRows.length === 0) {\n        return;\n      }\n\n      const item = selectedRows[0];\n\n      _Modal.confirm({\n        title: `Confirm to delete【menu data: ${item.name}】？`,\n        okText: 'confirm',\n        okType: 'danger',\n        cancelText: 'cancel',\n        onOk: this.handleDelOKClick.bind(this, item.id)\n      });\n    });\n\n    _defineProperty(this, \"handleTableSelectRow\", (record, selected) => {\n      const keys = [];\n      const rows = [];\n\n      if (selected) {\n        keys.push(record.id);\n        rows.push(record);\n      }\n\n      this.setState({\n        selectedRowKeys: keys,\n        selectedRows: rows\n      });\n    });\n\n    _defineProperty(this, \"onTableChange\", pagination => {\n      this.dispatch({\n        type: 'menu/fetch',\n        pagination: {\n          current: pagination.current,\n          pageSize: pagination.pageSize\n        }\n      });\n      this.clearSelectRows();\n    });\n\n    _defineProperty(this, \"onResetFormClick\", () => {\n      const {\n        form\n      } = this.props;\n      form.resetFields();\n      this.dispatch({\n        type: 'menu/fetch',\n        search: {\n          parent_id: this.getParentID()\n        },\n        pagination: {}\n      });\n    });\n\n    _defineProperty(this, \"onSearchFormSubmit\", e => {\n      if (e) {\n        e.preventDefault();\n      }\n\n      const {\n        form\n      } = this.props;\n      form.validateFields((err, values) => {\n        if (err) {\n          return;\n        }\n\n        this.dispatch({\n          type: 'menu/fetch',\n          search: _objectSpread(_objectSpread({}, values), {}, {\n            parent_id: this.getParentID()\n          }),\n          pagination: {}\n        });\n        this.clearSelectRows();\n      });\n    });\n\n    _defineProperty(this, \"handleFormSubmit\", data => {\n      this.dispatch({\n        type: 'menu/submit',\n        payload: data\n      });\n      this.clearSelectRows();\n    });\n\n    _defineProperty(this, \"handleFormCancel\", () => {\n      this.dispatch({\n        type: 'menu/changeFormVisible',\n        payload: false\n      });\n    });\n\n    _defineProperty(this, \"clearSelectRows\", () => {\n      const {\n        selectedRowKeys\n      } = this.state;\n\n      if (selectedRowKeys.length === 0) {\n        return;\n      }\n\n      this.setState({\n        selectedRowKeys: [],\n        selectedRows: []\n      });\n    });\n\n    _defineProperty(this, \"dispatch\", action => {\n      const {\n        dispatch\n      } = this.props;\n      dispatch(action);\n    });\n\n    _defineProperty(this, \"getParentID\", () => {\n      const {\n        treeSelectedKeys\n      } = this.state;\n      let parentID = '';\n\n      if (treeSelectedKeys.length > 0) {\n        [parentID] = treeSelectedKeys;\n      }\n\n      return parentID;\n    });\n\n    _defineProperty(this, \"renderTreeNodes\", data => data.map(item => {\n      if (item.children) {\n        return __jsx(_Tree.TreeNode, {\n          title: item.name,\n          key: item.id,\n          dataRef: item\n        }, this.renderTreeNodes(item.children));\n      }\n\n      return __jsx(_Tree.TreeNode, {\n        title: item.name,\n        key: item.id,\n        dataRef: item\n      });\n    }));\n  }\n\n  componentDidMount() {\n    this.dispatch({\n      type: 'menu/fetchTree'\n    });\n    this.dispatch({\n      type: 'menu/fetch',\n      search: {},\n      pagination: {}\n    });\n  }\n\n  handleDelOKClick(id) {\n    this.dispatch({\n      type: 'menu/del',\n      payload: {\n        id\n      }\n    });\n    this.clearSelectRows();\n  }\n\n  renderDataForm() {\n    return __jsx(MenuCard, {\n      onCancel: this.handleFormCancel,\n      onSubmit: this.handleFormSubmit\n    });\n  }\n\n  renderSearchForm() {\n    const {\n      form: {\n        getFieldDecorator\n      }\n    } = this.props;\n    return __jsx(Form, {\n      onSubmit: this.onSearchFormSubmit\n    }, __jsx(_Row, {\n      gutter: 16\n    }, __jsx(_Col, {\n      span: 8\n    }, __jsx(Form.Item, null, getFieldDecorator('queryValue')(__jsx(_Input, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\\u9700\\u8981\\u67E5\\u8BE2\\u7684\\u5185\\u5BB9\"\n    })))), __jsx(_Col, {\n      span: 8\n    }, __jsx(\"div\", {\n      style: {\n        overflow: 'hidden',\n        paddingTop: 4\n      }\n    }, __jsx(_Button, {\n      type: \"primary\",\n      htmlType: \"submit\"\n    }, \"\\u67E5\\u8BE2\"), __jsx(_Button, {\n      style: {\n        marginLeft: 8\n      },\n      onClick: this.onResetFormClick\n    }, \"\\u91CD\\u7F6E\")))));\n  }\n\n  render() {\n    const {\n      loading,\n      menu: {\n        data: {\n          list,\n          pagination\n        },\n        treeData,\n        expandedKeys\n      }\n    } = this.props;\n    const {\n      selectedRowKeys,\n      selectedRows\n    } = this.state;\n    const columns = [{\n      title: 'Menu Name',\n      dataIndex: 'name',\n      width: 130,\n      render: (val, row) => {\n        if (row.show_status !== 1) {\n          return __jsx(_Badge, {\n            status: \"default\",\n            text: val\n          });\n        }\n\n        return __jsx(\"span\", null, val);\n      }\n    }, {\n      title: 'Sort Value',\n      dataIndex: 'sequence',\n      width: 100\n    }, {\n      title: 'Menu Icon',\n      dataIndex: 'icon',\n      width: 100\n    }, {\n      title: 'Access Routing',\n      dataIndex: 'router',\n      width: 150\n    }, {\n      title: 'Status',\n      dataIndex: 'status',\n      width: 80,\n      render: val => {\n        if (val === 1) {\n          return __jsx(_Badge, {\n            status: \"success\",\n            text: \"Enable\"\n          });\n        }\n\n        return __jsx(_Badge, {\n          status: \"error\",\n          text: \"Deactivate\"\n        });\n      }\n    }, {\n      title: 'Created Time',\n      width: 150,\n      dataIndex: 'created_at',\n      render: val => __jsx(\"span\", null, formatDate(val, 'YYYY-MM-DD'))\n    }, {\n      title: 'Remarks',\n      dataIndex: 'memo'\n    }];\n\n    const paginationProps = _objectSpread({\n      showSizeChanger: true,\n      showQuickJumper: true,\n      showTotal: total => __jsx(\"span\", null, \"Total \", total, \" pages\")\n    }, pagination);\n\n    const breadcrumbList = [{\n      title: 'System Management'\n    }, {\n      title: 'Menu management',\n      href: '/system/menu'\n    }];\n    return __jsx(PageHeaderLayout, {\n      title: \"Menu management\",\n      breadcrumbList: breadcrumbList\n    }, __jsx(_Layout, null, __jsx(_Layout.Sider, {\n      width: 180,\n      style: {\n        background: '#fff',\n        borderRight: '1px solid lightGray',\n        padding: 15,\n        overflow: 'auto'\n      }\n    }, __jsx(_Tree, {\n      expandedKeys: expandedKeys,\n      onSelect: keys => {\n        this.setState({\n          treeSelectedKeys: keys\n        });\n        const {\n          menu: {\n            search\n          }\n        } = this.props;\n        const item = {\n          parentID: undefined\n        };\n\n        if (keys.length > 0) {\n          [item.parentID] = keys;\n        }\n\n        this.dispatch({\n          type: 'menu/fetch',\n          search: _objectSpread(_objectSpread({}, search), item),\n          pagination: {}\n        });\n      },\n      onExpand: keys => {\n        this.dispatch({\n          type: 'menu/saveExpandedKeys',\n          payload: keys\n        });\n      }\n    }, this.renderTreeNodes(treeData))), __jsx(_Layout.Content, null, __jsx(_Card, {\n      bordered: false\n    }, __jsx(\"div\", {\n      className: styles.tableList\n    }, __jsx(\"div\", {\n      className: styles.tableListForm\n    }, this.renderSearchForm()), __jsx(\"div\", {\n      className: styles.tableListOperator\n    }, __jsx(PButton, {\n      code: \"add\",\n      type: \"primary\",\n      onClick: () => this.handleAddClick()\n    }, \"New\"), selectedRowKeys.length === 1 && [__jsx(PButton, {\n      key: \"edit\",\n      code: \"edit\",\n      onClick: () => this.handleEditClick()\n    }, \"Edit\"), __jsx(PButton, {\n      key: \"del\",\n      code: \"del\",\n      type: \"danger\",\n      onClick: () => this.handleDelClick()\n    }, \"Delete\"), selectedRows[0].status === 2 && __jsx(PButton, {\n      key: \"enable\",\n      code: \"enable\",\n      onClick: () => this.onItemEnableClick(selectedRows[0])\n    }, \"Enable\"), selectedRows[0].status === 1 && __jsx(PButton, {\n      key: \"disable\",\n      code: \"disable\",\n      type: \"danger\",\n      onClick: () => this.onItemDisableClick(selectedRows[0])\n    }, \"Disable\")]), __jsx(_Table, {\n      rowSelection: {\n        selectedRowKeys,\n        onSelect: this.handleTableSelectRow\n      },\n      loading: loading,\n      rowKey: record => record.id,\n      dataSource: list,\n      columns: columns,\n      pagination: paginationProps,\n      onChange: this.onTableChange,\n      size: \"small\"\n    }))))), this.renderDataForm());\n  }\n\n}, _temp)) || _class);\nexport default WithDva(({\n  menu,\n  loading\n}) => ({\n  menu,\n  loading: loading.models.menu\n}))(MenuList); // export default MenuList;","map":null,"metadata":{},"sourceType":"module"}