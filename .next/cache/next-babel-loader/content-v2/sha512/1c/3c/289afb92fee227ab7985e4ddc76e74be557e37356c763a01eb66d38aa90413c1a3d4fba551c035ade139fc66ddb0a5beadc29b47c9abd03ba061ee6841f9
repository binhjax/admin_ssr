{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport dva from './dva-no-router';\nimport { connect } from 'react-redux';\nimport { Provider } from 'react-redux';\nimport model from '../models/index';\nimport createLoading from 'dva-loading';\n\nvar checkServer = function checkServer() {\n  return Object.prototype.toString.call(global.process) === '[object process]';\n}; // eslint-disable-next-line\n\n\nvar __NEXT_DVA_STORE__ = '__NEXT_DVA_STORE__';\n\nfunction createDvaStore(initialState) {\n  var app;\n\n  if (initialState) {\n    app = dva({\n      initialState: initialState\n    });\n  } else {\n    app = dva({});\n  }\n\n  var isArray = Array.isArray(model);\n\n  if (isArray) {\n    model.forEach(function (m) {\n      app.model(m);\n    });\n  } else {\n    app.model(model);\n  }\n\n  app.router(function () {});\n  app.use(createLoading({}));\n  app.start(); // console.log(app);\n  // eslint-disable-next-line\n\n  var store = app._store;\n  return store;\n}\n\nfunction getOrCreateStore(initialState) {\n  var isServer = checkServer();\n\n  if (isServer) {\n    // run in server\n    // console.log('server');\n    return createDvaStore(initialState);\n  } // eslint-disable-next-line\n\n\n  if (!window[__NEXT_DVA_STORE__]) {\n    // console.log('client');\n    // eslint-disable-next-line\n    window[__NEXT_DVA_STORE__] = createDvaStore(initialState);\n  } // eslint-disable-next-line\n\n\n  return window[__NEXT_DVA_STORE__];\n}\n\nexport default function withDva() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  return function CreateNextPage(Component) {\n    var ComponentWithDva = function ComponentWithDva() {\n      var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      var store = props.store,\n          initialState = props.initialState,\n          rest = _objectWithoutProperties(props, [\"store\", \"initialState\"]);\n\n      var ConnectedComponent = connect.apply(void 0, args)(Component);\n      return /*#__PURE__*/React.createElement(Provider, // in client side, it will init store with the initial state tranfer from server side\n      {\n        store: store && store.dispatch ? store : getOrCreateStore(initialState)\n      },\n      /*#__PURE__*/\n      // transfer next.js's props to the page\n      React.createElement(ConnectedComponent, rest));\n    };\n\n    ComponentWithDva.getInitialProps = /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var props,\n          isServer,\n          store,\n          initialProps,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              props = _args.length > 0 && _args[0] !== undefined ? _args[0] : {};\n              // console.log('get......');\n              isServer = checkServer();\n              store = getOrCreateStore(props.req); // call children's getInitialProps\n              // get initProps and transfer in to the page\n\n              if (!Component.getInitialProps) {\n                _context.next = 9;\n                break;\n              }\n\n              _context.next = 6;\n              return Component.getInitialProps(_objectSpread(_objectSpread({}, props), {}, {\n                isServer: isServer,\n                store: store\n              }));\n\n            case 6:\n              _context.t0 = _context.sent;\n              _context.next = 10;\n              break;\n\n            case 9:\n              _context.t0 = {};\n\n            case 10:\n              initialProps = _context.t0;\n              return _context.abrupt(\"return\", {\n                store: store,\n                initialProps: initialProps,\n                initialState: store.getState()\n              });\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return ComponentWithDva;\n  };\n}","map":{"version":3,"sources":["/Volumes/ExternalData/Work/vnshop/admin/src/utils/store.js"],"names":["React","dva","connect","Provider","model","createLoading","checkServer","Object","prototype","toString","call","global","process","__NEXT_DVA_STORE__","createDvaStore","initialState","app","isArray","Array","forEach","m","router","use","start","store","_store","getOrCreateStore","isServer","window","withDva","args","CreateNextPage","Component","ComponentWithDva","props","rest","ConnectedComponent","createElement","dispatch","getInitialProps","req","initialProps","getState"],"mappings":"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","sourcesContent":["import React from 'react';\nimport dva from './dva-no-router';\nimport { connect } from 'react-redux';\n\nimport { Provider } from 'react-redux';\nimport model from '../models/index';\nimport createLoading from 'dva-loading';\n\nconst checkServer = () => Object.prototype.toString.call(global.process) === '[object process]';\n\n// eslint-disable-next-line\nconst __NEXT_DVA_STORE__ = '__NEXT_DVA_STORE__';\n\nfunction createDvaStore(initialState) {\n  let app;\n  if (initialState) {\n    app = dva({\n      initialState,\n    });\n  } else {\n    app = dva({});\n  }\n  const isArray = Array.isArray(model);\n  if (isArray) {\n    model.forEach(m => {\n      app.model(m);\n    });\n  } else {\n    app.model(model);\n  }\n  app.router(() => {});\n  app.use(createLoading({}));\n  app.start();\n  // console.log(app);\n  // eslint-disable-next-line\n  const store = app._store;\n  return store;\n}\n\nfunction getOrCreateStore(initialState) {\n  const isServer = checkServer();\n  if (isServer) {\n    // run in server\n    // console.log('server');\n    return createDvaStore(initialState);\n  }\n  // eslint-disable-next-line\n  if (!window[__NEXT_DVA_STORE__]) {\n    // console.log('client');\n    // eslint-disable-next-line\n    window[__NEXT_DVA_STORE__] = createDvaStore(initialState);\n  }\n  // eslint-disable-next-line\n  return window[__NEXT_DVA_STORE__];\n}\n\nexport default function withDva(...args) {\n  return function CreateNextPage(Component) {\n    const ComponentWithDva = (props = {}) => {\n      const { store, initialState, ...rest } = props;\n      const ConnectedComponent = connect(...args)(Component);\n      return React.createElement(\n        Provider,\n        // in client side, it will init store with the initial state tranfer from server side\n        { store: store && store.dispatch ? store : getOrCreateStore(initialState) },\n        // transfer next.js's props to the page\n        React.createElement(ConnectedComponent, rest)\n      );\n    };\n    ComponentWithDva.getInitialProps = async (props = {}) => {\n      // console.log('get......');\n      const isServer = checkServer();\n      const store = getOrCreateStore(props.req);\n      // call children's getInitialProps\n      // get initProps and transfer in to the page\n      const initialProps = Component.getInitialProps\n        ? await Component.getInitialProps({ ...props, isServer, store })\n        : {};\n      // console.log(\"WithDva: \", initialProps)\n      return {\n        store,\n        initialProps,\n        initialState: store.getState(),\n      };\n    };\n    return ComponentWithDva;\n  };\n}\n"]},"metadata":{},"sourceType":"module"}