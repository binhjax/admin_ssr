{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport \"antd/lib/spin/style\";\nimport _Spin from \"antd/lib/spin\";\nimport \"antd/lib/dropdown/style\";\nimport _Dropdown from \"antd/lib/dropdown\";\nimport \"antd/lib/avatar/style\";\nimport _Avatar from \"antd/lib/avatar\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _initializerDefineProperty from \"@babel/runtime/helpers/esm/initializerDefineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _applyDecoratedDescriptor from \"@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _initializerWarningHelper from \"@babel/runtime/helpers/esm/initializerWarningHelper\";\nimport \"antd/lib/menu/style\";\nimport _Menu from \"antd/lib/menu\";\nimport \"antd/lib/layout/style\";\nimport _Layout from \"antd/lib/layout\";\n\nvar _dec, _class, _descriptor, _temp;\n\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react'; // import { Icon as LegacyIcon } from '@ant-design/compatible';\n\nimport { LockOutlined, LogoutOutlined, UserOutlined, MenuFoldOutlined, MenuUnfoldOutlined } from '@ant-design/icons';\nimport DocumentTitle from 'react-document-title'; // import { connect } from 'dva';\n\nimport WithDva from '../utils/store';\nimport { withRouter } from 'next/router'; // import { useRouter } from 'next/router'\n// eslint-disable-next-line import/no-extraneous-dependencies\n\nimport Link from 'next/link';\nimport { ContainerQuery } from 'react-container-query';\nimport classNames from 'classnames';\nimport Debounce from 'lodash-decorators/debounce';\nimport GlobalFooter from '@/components/GlobalFooter';\nimport CopyRight from '@/components/CopyRight';\nimport UpdatePasswordDialog from '@/layouts/UpdatePasswordDialog';\nimport context from '@/utils/context';\nimport './AdminLayout.less';\nimport logo from '../assets/logo.svg';\nvar Header = _Layout.Header,\n    Sider = _Layout.Sider,\n    Content = _Layout.Content;\nvar SubMenu = _Menu.SubMenu;\nvar query = {\n  'screen-xs': {\n    maxWidth: 575\n  },\n  'screen-sm': {\n    minWidth: 576,\n    maxWidth: 767\n  },\n  'screen-md': {\n    minWidth: 768,\n    maxWidth: 991\n  },\n  'screen-lg': {\n    minWidth: 992,\n    maxWidth: 1199\n  },\n  'screen-xl': {\n    minWidth: 1200\n  }\n};\nvar AdminLayout = (_dec = Debounce(600), (_class = (_temp = /*#__PURE__*/function (_React$PureComponent) {\n  _inherits(AdminLayout, _React$PureComponent);\n\n  var _super = _createSuper(AdminLayout);\n\n  function AdminLayout() {\n    var _this;\n\n    _classCallCheck(this, AdminLayout);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      updatePwdVisible: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"dispatch\", function (action) {\n      var dispatch = _this.props.dispatch;\n      dispatch(action);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onCollapse\", function () {\n      var collapsed = _this.props.collapsed;\n\n      _this.dispatch({\n        type: 'global/changeLayoutCollapsed',\n        payload: !collapsed\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onMenuClick\", function (_ref) {\n      var key = _ref.key;\n\n      if (key === 'logout') {\n        _this.dispatch({\n          type: 'login/logout'\n        });\n      } else if (key === 'updatepwd') {\n        _this.setState({\n          updatePwdVisible: true\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onMenuOpenChange\", function (openKeys) {\n      var menuMap = _this.props.menuMap;\n\n      if (openKeys.length > 1) {\n        var lastKey = openKeys[openKeys.length - 1];\n        var lastItem = menuMap[lastKey];\n\n        if (!lastItem) {\n          _this.dispatch({\n            type: 'global/changeOpenKeys',\n            payload: []\n          });\n\n          return;\n        }\n\n        var isParent = false;\n\n        for (var i = 0; i < openKeys.length - 1; i += 1) {\n          var item = menuMap[openKeys[i]] || {};\n          var path = item.id;\n\n          if (item.parent_path !== '') {\n            path = \"\".concat(item.parent_path, \"/\").concat(path);\n          }\n\n          if (lastItem.parent_path === path) {\n            isParent = true;\n            break;\n          }\n        }\n\n        if (!isParent) {\n          _this.dispatch({\n            type: 'global/changeOpenKeys',\n            payload: [lastKey]\n          });\n\n          return;\n        }\n      }\n\n      _this.dispatch({\n        type: 'global/changeOpenKeys',\n        payload: _toConsumableArray(openKeys)\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onToggleClick\", function () {\n      var collapsed = _this.props.collapsed;\n\n      _this.dispatch({\n        type: 'global/changeLayoutCollapsed',\n        payload: !collapsed\n      });\n\n      _this.onTriggerResizeEvent();\n    });\n\n    _initializerDefineProperty(_assertThisInitialized(_this), \"onTriggerResizeEvent\", _descriptor, _assertThisInitialized(_this));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleUpdatePwdCancel\", function () {\n      _this.setState({\n        updatePwdVisible: false\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(AdminLayout, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      console.log('componentDidMount: ', this.props);\n      var pathname = this.props.router.pathname;\n      this.dispatch({\n        type: 'global/fetchUser'\n      });\n      this.dispatch({\n        type: 'global/fetchMenuTree',\n        pathname: pathname\n      });\n    }\n  }, {\n    key: \"renderNavMenuItems\",\n    value: function renderNavMenuItems(menusData) {\n      var _this2 = this;\n\n      if (!menusData) {\n        return [];\n      }\n\n      return menusData.map(function (item) {\n        if (!item.name || item.show_status !== 1) {\n          return null;\n        }\n\n        if (item.children && item.children.some(function (child) {\n          return child.name && child.show_status === 1;\n        })) {\n          return __jsx(SubMenu, {\n            title: item.icon ? __jsx(\"span\", null, __jsx(\"span\", null, item.name)) : item.name,\n            key: item.id\n          }, _this2.renderNavMenuItems(item.children));\n        }\n\n        var router = item.router; // const icon = item.icon && <LegacyIcon type={item.icon} />;\n        // console.log(\"renderNavMenuItems: \", this.props);\n\n        var pathname = _this2.props.router.pathname;\n        return __jsx(_Menu.Item, {\n          key: item.id\n        }, router.startsWith('http') ? __jsx(\"a\", {\n          href: router,\n          target: \"_blank\",\n          rel: \"noopener noreferrer\"\n        }, icon, __jsx(\"span\", null, item.name)) : __jsx(Link, {\n          href: router,\n          replace: router === pathname\n        }, __jsx(\"div\", null, __jsx(\"span\", null, item.name))));\n      });\n    }\n  }, {\n    key: \"renderPageTitle\",\n    value: function renderPageTitle() {\n      var _this$props = this.props,\n          pathname = _this$props.router.pathname,\n          menuPaths = _this$props.menuPaths,\n          title = _this$props.title;\n      console.log('renderPageTitle: pathname', pathname);\n      var ptitle = title;\n      var item = menuPaths[pathname];\n\n      if (item) {\n        ptitle = \"\".concat(item.name, \" - \").concat(title);\n      }\n\n      return ptitle;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _this$props2 = this.props,\n          children = _this$props2.children,\n          user = _this$props2.user,\n          collapsed = _this$props2.collapsed,\n          menus = _this$props2.menus,\n          copyRight = _this$props2.copyRight,\n          openKeys = _this$props2.openKeys,\n          title = _this$props2.title,\n          selectedKeys = _this$props2.selectedKeys,\n          global = _this$props2.global;\n      var updatePwdVisible = this.state.updatePwdVisible;\n\n      var menu = __jsx(_Menu, {\n        className: \"menu\",\n        selectedKeys: [],\n        onClick: this.onMenuClick\n      }, __jsx(_Menu.Item, {\n        key: \"updatepwd\"\n      }, __jsx(LockOutlined, null), \"Change Password\"), __jsx(_Menu.Divider, null), __jsx(_Menu.Item, {\n        key: \"logout\"\n      }, __jsx(LogoutOutlined, null), \"Sign Out\")); // Don't show popup menu when it is been collapsed\n\n\n      var menuProps = collapsed ? {} : {\n        openKeys: openKeys\n      };\n      var siderWidth = 256;\n\n      var layout = __jsx(_Layout, null, __jsx(Sider, {\n        trigger: null,\n        collapsible: true,\n        collapsed: collapsed,\n        breakpoint: \"lg\",\n        onCollapse: this.onCollapse,\n        width: siderWidth,\n        className: \"sider\"\n      }, __jsx(\"div\", {\n        className: \"logo\"\n      }, __jsx(Link, {\n        href: \"/\"\n      }, __jsx(\"div\", null, __jsx(\"img\", {\n        src: logo,\n        alt: \"logo\"\n      }), __jsx(\"h1\", null, title)))), __jsx(_Menu, _extends({\n        theme: \"dark\",\n        mode: \"inline\"\n      }, menuProps, {\n        onOpenChange: this.onMenuOpenChange,\n        selectedKeys: selectedKeys,\n        style: {\n          margin: '16px 0',\n          width: '100%'\n        }\n      }), this.renderNavMenuItems(menus))), __jsx(_Layout, null, __jsx(Header, {\n        className: classNames('header'),\n        style: {\n          paddingLeft: 12,\n          paddingRight: 12\n        }\n      }, __jsx(\"div\", {\n        className: classNames('foldout'),\n        onClick: function onClick() {\n          return _this3.onCollapse();\n        }\n      }, collapsed ? __jsx(MenuUnfoldOutlined, null) : __jsx(MenuFoldOutlined, null)), __jsx(\"div\", {\n        className: classNames('right')\n      }, user.user_name ? __jsx(_Dropdown, {\n        overlay: menu\n      }, __jsx(\"span\", {\n        className: classNames(['action', 'account'])\n      }, __jsx(_Avatar, {\n        size: \"small\",\n        className: classNames('avatar'),\n        icon: __jsx(UserOutlined, null)\n      }), // user.real_name !== ''\n      // ? `${user.user_name}(${user.real_name})`\n      // : user.user_name\n      user.user_name)) : __jsx(_Spin, {\n        size: \"small\",\n        style: {\n          marginLeft: 8\n        }\n      }))), __jsx(Content, {\n        className: classNames('content')\n      }, __jsx(\"div\", {\n        style: {\n          minHeight: 'calc(100vh - 150px)'\n        }\n      }, __jsx(context.GlobalContext.Provider, {\n        value: global\n      }, children)), __jsx(GlobalFooter, {\n        copyright: __jsx(CopyRight, {\n          title: copyRight\n        })\n      }))), __jsx(UpdatePasswordDialog, {\n        visible: updatePwdVisible,\n        onCancel: this.handleUpdatePwdCancel\n      }));\n\n      return __jsx(DocumentTitle, {\n        title: this.renderPageTitle()\n      }, __jsx(ContainerQuery, {\n        query: query\n      }, function (params) {\n        return __jsx(\"div\", {\n          className: classNames(params)\n        }, layout);\n      }));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function () {\n      var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(props) {\n        var pathname, query, isServer, store;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                // first time run in server side\n                // other times run in client side ( client side init with default props\n                // console.log('get init props', props);\n                pathname = props.pathname, query = props.query, isServer = props.isServer, store = props.store; // dispatch effects to fetch data here\n\n                return _context.abrupt(\"return\", {\n                  // dont use store as property name, it will confilct with initial store\n                  pathname: pathname,\n                  query: query,\n                  isServer: isServer,\n                  dvaStore: store\n                });\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function getInitialProps(_x) {\n        return _getInitialProps.apply(this, arguments);\n      }\n\n      return getInitialProps;\n    }()\n  }]);\n\n  return AdminLayout;\n}(React.PureComponent), _temp), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"onTriggerResizeEvent\", [_dec], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return function () {\n      var event = document.createEvent('HTMLEvents');\n      event.initEvent('resize', true, false);\n      window.dispatchEvent(event);\n    };\n  }\n})), _class)); // export default AdminLayout;\n\nexport default WithDva(function (state) {\n  return {\n    title: state.global.title,\n    copyRight: state.global.copyRight,\n    collapsed: state.global.collapsed,\n    openKeys: state.global.openKeys,\n    selectedKeys: state.global.selectedKeys,\n    user: state.global.user,\n    menuPaths: state.global.menuPaths,\n    menuMap: state.global.menuMap,\n    menus: state.global.menus,\n    global: state.global\n  };\n})(withRouter(AdminLayout));","map":null,"metadata":{},"sourceType":"module"}