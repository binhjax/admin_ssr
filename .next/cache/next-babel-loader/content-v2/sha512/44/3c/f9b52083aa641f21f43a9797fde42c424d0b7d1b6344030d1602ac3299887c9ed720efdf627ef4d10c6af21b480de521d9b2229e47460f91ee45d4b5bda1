{"ast":null,"code":"import \"antd/lib/notification/style\";\nimport _notification from \"antd/lib/notification\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport axios from 'axios';\nimport moment from 'moment';\nimport { history } from 'next/link';\nimport { stringify, parse } from 'qs';\nimport jsCookie from 'js-cookie';\nimport { startURL } from '../config/constant';\nimport store, { storeKeys } from './persistent-store';\nvar refreshTimeout;\nvar lastAccessTime;\nexport var baseURL = '/api';\nexport var contentType = {\n  form: 'application/x-www-form-urlencoded',\n  json: 'application/json'\n};\nexport var headerKeys = {\n  ContentType: 'Content-Type',\n  Authorization: 'Authorization'\n};\nexport var methods = {\n  GET: 'GET',\n  POST: 'POST',\n  PUT: 'PUT',\n  DELETE: 'DELETE',\n  PATCH: 'PATCH',\n  HEAD: 'HEAD',\n  OPTIONS: 'OPTIONS'\n}; // Get access token\n\nexport function getAccessToken() {\n  var token = store.get(storeKeys.AccessToken);\n\n  if (!token) {\n    return '';\n  }\n\n  return token.access_token;\n  return '';\n} // Wrap the URL with the token\n\nexport function wrapURLWithToken(url) {\n  var ss = url.split('?');\n  var query = parse(ss[1]);\n  query.accessToken = getAccessToken();\n  return \"\".concat(ss[0], \"?\").concat(stringify(query));\n} // 登出\n\nexport function logout() {\n  console.log('Logout event');\n\n  if (refreshTimeout) {\n    clearTimeout(refreshTimeout);\n  } //binhnt: Remove cookie\n\n\n  jsCookie.remove('token'); //Remove AccessToken\n\n  store.remove(storeKeys.AccessToken);\n\n  var _parse = parse(window.location.href.split('?')[1]),\n      redirect = _parse.redirect;\n\n  if (window.location.pathname !== startURL + '/login' && !redirect) {\n    window.location = startURL + '/login'; // window.history.replace({\n    //   pathname: '/user/login',\n    //   search: stringify({\n    //     redirect: window.location.href,\n    //   }),\n    // });\n  }\n} // request 拦截器\n\nfunction requestInterceptors(c) {\n  var config = _objectSpread({}, c);\n\n  var token = store.get(storeKeys.AccessToken);\n\n  if (token) {\n    // console.log(\n    //   'binhnt.requestInterceptors: Token = ',\n    //   token.access_token,\n    //   headerKeys.Authorization\n    // );\n    config.headers[headerKeys.Authorization] = \"\".concat(token.token_type, \" \").concat(token.access_token);\n  }\n\n  return config;\n} // ajax请求\n\n\nexport default function request(url) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  // console.log('AccessToken: ', storeKeys.AccessToken);\n  var oldToken = store.get(storeKeys.AccessToken); // console.log(\"oldToken: \", oldToken);\n\n  if (oldToken && oldToken.expires_at - lastAccessTime <= 0) {\n    if (refreshTimeout) {\n      clearTimeout(refreshTimeout);\n    }\n\n    logout(); // eslint-disable-next-line compat/compat\n\n    return Promise.reject(new Error('The token has expired'));\n  }\n\n  lastAccessTime = moment().unix();\n\n  var opts = _objectSpread({}, options);\n\n  var showNotify = true;\n\n  if (opts.hideNotify) {\n    showNotify = false;\n    delete opts.hideNotify;\n  }\n\n  var config = _objectSpread({\n    method: methods.GET,\n    baseURL: baseURL,\n    headers: {},\n    transformRequest: function transformRequest(data, headers) {\n      switch (headers[headerKeys.ContentType]) {\n        case contentType.json:\n          return JSON.stringify(data);\n\n        case contentType.form:\n          return stringify(data);\n\n        default:\n          return data;\n      }\n    },\n    paramsSerializer: function paramsSerializer(params) {\n      return stringify(params);\n    },\n    timeout: 60000\n  }, opts);\n\n  if (!(config.headers && config.headers[headerKeys.ContentType]) && [methods.POST, methods.PUT, methods.PATCH].indexOf(config.method) > -1) {\n    config.headers[headerKeys.ContentType] = contentType.json;\n  }\n\n  var instance = axios.create(config);\n  instance.interceptors.request.use(requestInterceptors);\n  return instance.request({\n    url: url\n  }).then(function (res) {\n    var data = res.data; // console.log('request.request: Data: ', data, 'url', url);\n\n    return data;\n  }).catch(function (error) {\n    var response = error.response;\n    var status = response.status,\n        data = response.data;\n\n    if (status === 401 && data.error && data.error.code === 9999) {\n      logout();\n      return response;\n    }\n\n    if (showNotify) {\n      var msg = 'Request error';\n\n      if (status === 504) {\n        msg = 'Not connected to server';\n      } else if (data && data.error) {\n        msg = data.error.message;\n      }\n\n      _notification.error({\n        message: \"\".concat(config.baseURL).concat(url),\n        description: msg\n      });\n    }\n\n    return response;\n  });\n} // Put in the access token\n\nexport function setToken(token) {\n  //binhnt: 1. Add cookies to access nextjs\n  jsCookie.set('token', token.access_token); //binhnt: 2. Add Token to access Backend\n\n  lastAccessTime = token.expires_at;\n  store.set(storeKeys.AccessToken, token);\n\n  if (refreshTimeout) {\n    clearTimeout(refreshTimeout);\n  } // Renew the token 10 minutes in advance\n\n\n  var timeout = token.expires_at - moment().unix() - 10;\n\n  if (timeout > 0) {\n    refreshTimeout = setTimeout(function () {\n      var oldToken = store.get(storeKeys.AccessToken);\n\n      if (oldToken && oldToken.expires_at - lastAccessTime <= 0) {\n        if (refreshTimeout) {\n          clearTimeout(refreshTimeout);\n        }\n\n        return;\n      }\n\n      request('/v1/pub/refresh-token', {\n        method: methods.POST\n      }).then(function (res) {\n        setToken(res);\n      });\n    }, timeout * 1000);\n  }\n}","map":{"version":3,"sources":["/Volumes/ExternalData/Work/vnshop/admin/src/utils/request.js"],"names":["axios","moment","history","stringify","parse","jsCookie","startURL","store","storeKeys","refreshTimeout","lastAccessTime","baseURL","contentType","form","json","headerKeys","ContentType","Authorization","methods","GET","POST","PUT","DELETE","PATCH","HEAD","OPTIONS","getAccessToken","token","get","AccessToken","access_token","wrapURLWithToken","url","ss","split","query","accessToken","logout","console","log","clearTimeout","remove","window","location","href","redirect","pathname","requestInterceptors","c","config","headers","token_type","request","options","oldToken","expires_at","Promise","reject","Error","unix","opts","showNotify","hideNotify","method","transformRequest","data","JSON","paramsSerializer","params","timeout","indexOf","instance","create","interceptors","use","then","res","catch","error","response","status","code","msg","message","description","setToken","set","setTimeout"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport moment from 'moment';\nimport { history } from 'next/link';\nimport { stringify, parse } from 'qs';\nimport { notification } from 'antd';\nimport jsCookie from 'js-cookie';\nimport { startURL } from '../config/constant';\n\nimport store, { storeKeys } from './persistent-store';\n\nlet refreshTimeout;\nlet lastAccessTime;\n\nexport const baseURL = '/api';\n\nexport const contentType = {\n  form: 'application/x-www-form-urlencoded',\n  json: 'application/json',\n};\n\nexport const headerKeys = {\n  ContentType: 'Content-Type',\n  Authorization: 'Authorization',\n};\n\nexport const methods = {\n  GET: 'GET',\n  POST: 'POST',\n  PUT: 'PUT',\n  DELETE: 'DELETE',\n  PATCH: 'PATCH',\n  HEAD: 'HEAD',\n  OPTIONS: 'OPTIONS',\n};\n\n// Get access token\nexport function getAccessToken() {\n  const token = store.get(storeKeys.AccessToken);\n  if (!token) {\n    return '';\n  }\n  return token.access_token;\n  return '';\n}\n\n// Wrap the URL with the token\nexport function wrapURLWithToken(url) {\n  const ss = url.split('?');\n  const query = parse(ss[1]);\n  query.accessToken = getAccessToken();\n  return `${ss[0]}?${stringify(query)}`;\n}\n\n// 登出\nexport function logout() {\n  console.log('Logout event');\n  if (refreshTimeout) {\n    clearTimeout(refreshTimeout);\n  }\n  //binhnt: Remove cookie\n  jsCookie.remove('token');\n\n  //Remove AccessToken\n  store.remove(storeKeys.AccessToken);\n  const { redirect } = parse(window.location.href.split('?')[1]);\n  if (window.location.pathname !== startURL + '/login' && !redirect) {\n    window.location = startURL + '/login';\n    // window.history.replace({\n    //   pathname: '/user/login',\n    //   search: stringify({\n    //     redirect: window.location.href,\n    //   }),\n    // });\n  }\n}\n\n// request 拦截器\nfunction requestInterceptors(c) {\n  const config = { ...c };\n  const token = store.get(storeKeys.AccessToken);\n  if (token) {\n    // console.log(\n    //   'binhnt.requestInterceptors: Token = ',\n    //   token.access_token,\n    //   headerKeys.Authorization\n    // );\n    config.headers[headerKeys.Authorization] = `${token.token_type} ${token.access_token}`;\n  }\n  return config;\n}\n\n// ajax请求\nexport default function request(url, options = {}) {\n  // console.log('AccessToken: ', storeKeys.AccessToken);\n  const oldToken = store.get(storeKeys.AccessToken);\n  // console.log(\"oldToken: \", oldToken);\n  if (oldToken && oldToken.expires_at - lastAccessTime <= 0) {\n    if (refreshTimeout) {\n      clearTimeout(refreshTimeout);\n    }\n    logout();\n    // eslint-disable-next-line compat/compat\n    return Promise.reject(new Error('The token has expired'));\n  }\n  lastAccessTime = moment().unix();\n\n  const opts = { ...options };\n  let showNotify = true;\n  if (opts.hideNotify) {\n    showNotify = false;\n    delete opts.hideNotify;\n  }\n\n  const config = {\n    method: methods.GET,\n    baseURL,\n    headers: {},\n    transformRequest: (data, headers) => {\n      switch (headers[headerKeys.ContentType]) {\n        case contentType.json:\n          return JSON.stringify(data);\n        case contentType.form:\n          return stringify(data);\n        default:\n          return data;\n      }\n    },\n    paramsSerializer: params => {\n      return stringify(params);\n    },\n    timeout: 60000,\n    ...opts,\n  };\n\n  if (\n    !(config.headers && config.headers[headerKeys.ContentType]) &&\n    [methods.POST, methods.PUT, methods.PATCH].indexOf(config.method) > -1\n  ) {\n    config.headers[headerKeys.ContentType] = contentType.json;\n  }\n\n  const instance = axios.create(config);\n  instance.interceptors.request.use(requestInterceptors);\n\n  return instance\n    .request({ url })\n    .then(res => {\n      const { data } = res;\n      // console.log('request.request: Data: ', data, 'url', url);\n      return data;\n    })\n    .catch(error => {\n      const { response } = error;\n      const { status, data } = response;\n\n      if (status === 401 && data.error && data.error.code === 9999) {\n        logout();\n        return response;\n      }\n\n      if (showNotify) {\n        let msg = 'Request error';\n        if (status === 504) {\n          msg = 'Not connected to server';\n        } else if (data && data.error) {\n          msg = data.error.message;\n        }\n\n        notification.error({\n          message: `${config.baseURL}${url}`,\n          description: msg,\n        });\n      }\n      return response;\n    });\n}\n\n// Put in the access token\nexport function setToken(token) {\n  //binhnt: 1. Add cookies to access nextjs\n  jsCookie.set('token', token.access_token);\n\n  //binhnt: 2. Add Token to access Backend\n  lastAccessTime = token.expires_at;\n  store.set(storeKeys.AccessToken, token);\n  if (refreshTimeout) {\n    clearTimeout(refreshTimeout);\n  }\n\n  // Renew the token 10 minutes in advance\n  const timeout = token.expires_at - moment().unix() - 10;\n  if (timeout > 0) {\n    refreshTimeout = setTimeout(() => {\n      const oldToken = store.get(storeKeys.AccessToken);\n      if (oldToken && oldToken.expires_at - lastAccessTime <= 0) {\n        if (refreshTimeout) {\n          clearTimeout(refreshTimeout);\n        }\n        return;\n      }\n\n      request('/v1/pub/refresh-token', {\n        method: methods.POST,\n      }).then(res => {\n        setToken(res);\n      });\n    }, timeout * 1000);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}