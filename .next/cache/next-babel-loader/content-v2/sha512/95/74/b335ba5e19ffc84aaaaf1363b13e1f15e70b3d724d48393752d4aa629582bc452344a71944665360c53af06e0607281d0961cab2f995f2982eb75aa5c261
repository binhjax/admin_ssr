{"ast":null,"code":"import \"antd/lib/message/style\";\nimport _message from \"antd/lib/message\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport * as roleService from '@/services/role';\nexport default {\n  namespace: 'role',\n  state: {\n    search: {},\n    pagination: {},\n    data: {\n      list: [],\n      pagination: {}\n    },\n    submitting: false,\n    formTitle: '',\n    formID: '',\n    formVisible: false,\n    formData: {},\n    selectData: []\n  },\n  effects: {\n    fetch: /*#__PURE__*/_regeneratorRuntime.mark(function fetch(_ref, _ref2) {\n      var search, pagination, call, put, select, params, s, p, response;\n      return _regeneratorRuntime.wrap(function fetch$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              search = _ref.search, pagination = _ref.pagination;\n              call = _ref2.call, put = _ref2.put, select = _ref2.select;\n              params = {};\n\n              if (!search) {\n                _context.next = 9;\n                break;\n              }\n\n              params = _objectSpread(_objectSpread({}, params), search);\n              _context.next = 7;\n              return put({\n                type: 'saveSearch',\n                payload: search\n              });\n\n            case 7:\n              _context.next = 13;\n              break;\n\n            case 9:\n              _context.next = 11;\n              return select(function (state) {\n                return state.role.search;\n              });\n\n            case 11:\n              s = _context.sent;\n\n              if (s) {\n                params = _objectSpread(_objectSpread({}, params), s);\n              }\n\n            case 13:\n              if (!pagination) {\n                _context.next = 19;\n                break;\n              }\n\n              params = _objectSpread(_objectSpread({}, params), pagination);\n              _context.next = 17;\n              return put({\n                type: 'savePagination',\n                payload: pagination\n              });\n\n            case 17:\n              _context.next = 23;\n              break;\n\n            case 19:\n              _context.next = 21;\n              return select(function (state) {\n                return state.role.pagination;\n              });\n\n            case 21:\n              p = _context.sent;\n\n              if (p) {\n                params = _objectSpread(_objectSpread({}, params), p);\n              }\n\n            case 23:\n              _context.next = 25;\n              return call(roleService.query, params);\n\n            case 25:\n              response = _context.sent;\n              _context.next = 28;\n              return put({\n                type: 'saveData',\n                payload: response\n              });\n\n            case 28:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, fetch);\n    }),\n    loadForm: /*#__PURE__*/_regeneratorRuntime.mark(function loadForm(_ref3, _ref4) {\n      var payload, put;\n      return _regeneratorRuntime.wrap(function loadForm$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              payload = _ref3.payload;\n              put = _ref4.put;\n              _context2.next = 4;\n              return put({\n                type: 'changeFormVisible',\n                payload: true\n              });\n\n            case 4:\n              _context2.next = 6;\n              return [put({\n                type: 'saveFormType',\n                payload: payload.type\n              }), put({\n                type: 'saveFormTitle',\n                payload: 'New role'\n              }), put({\n                type: 'saveFormID',\n                payload: ''\n              }), put({\n                type: 'saveFormData',\n                payload: {}\n              })];\n\n            case 6:\n              if (!(payload.type === 'E')) {\n                _context2.next = 9;\n                break;\n              }\n\n              _context2.next = 9;\n              return [put({\n                type: 'saveFormTitle',\n                payload: 'Edit role'\n              }), put({\n                type: 'saveFormID',\n                payload: payload.id\n              }), put({\n                type: 'fetchForm',\n                payload: {\n                  id: payload.id\n                }\n              })];\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, loadForm);\n    }),\n    fetchForm: /*#__PURE__*/_regeneratorRuntime.mark(function fetchForm(_ref5, _ref6) {\n      var payload, call, put, response, roleMenus, mRoleMenus, nRoleMenus;\n      return _regeneratorRuntime.wrap(function fetchForm$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              payload = _ref5.payload;\n              call = _ref6.call, put = _ref6.put;\n              _context3.next = 4;\n              return call(roleService.get, payload.id);\n\n            case 4:\n              response = _context3.sent;\n              roleMenus = response.role_menus;\n\n              if (roleMenus) {\n                mRoleMenus = {};\n                nRoleMenus = [];\n                roleMenus.forEach(function (item) {\n                  if (mRoleMenus[item.menu_id]) {\n                    mRoleMenus[item.menu_id] = [].concat(_toConsumableArray(mRoleMenus[item.menu_id]), [item.action_id]);\n                  } else {\n                    mRoleMenus[item.menu_id] = [item.action_id];\n                  }\n                });\n                Object.keys(mRoleMenus).forEach(function (key) {\n                  nRoleMenus.push({\n                    menu_id: key,\n                    actions: mRoleMenus[key]\n                  });\n                });\n                response.role_menus = nRoleMenus;\n              }\n\n              _context3.next = 9;\n              return [put({\n                type: 'saveFormData',\n                payload: response\n              })];\n\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, fetchForm);\n    }),\n    submit: /*#__PURE__*/_regeneratorRuntime.mark(function submit(_ref7, _ref8) {\n      var payload, call, put, select, params, formType, success, id, response, _response;\n\n      return _regeneratorRuntime.wrap(function submit$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              payload = _ref7.payload;\n              call = _ref8.call, put = _ref8.put, select = _ref8.select;\n              _context4.next = 4;\n              return put({\n                type: 'changeSubmitting',\n                payload: true\n              });\n\n            case 4:\n              params = _objectSpread({}, payload);\n              _context4.next = 7;\n              return select(function (state) {\n                return state.role.formType;\n              });\n\n            case 7:\n              formType = _context4.sent;\n              success = false;\n\n              if (!(formType === 'E')) {\n                _context4.next = 19;\n                break;\n              }\n\n              _context4.next = 12;\n              return select(function (state) {\n                return state.role.formID;\n              });\n\n            case 12:\n              id = _context4.sent;\n              _context4.next = 15;\n              return call(roleService.update, id, params);\n\n            case 15:\n              response = _context4.sent;\n\n              if (response.status === 'OK') {\n                success = true;\n              }\n\n              _context4.next = 23;\n              break;\n\n            case 19:\n              _context4.next = 21;\n              return call(roleService.create, params);\n\n            case 21:\n              _response = _context4.sent;\n\n              if (_response.id && _response.id !== '') {\n                success = true;\n              }\n\n            case 23:\n              _context4.next = 25;\n              return put({\n                type: 'changeSubmitting',\n                payload: false\n              });\n\n            case 25:\n              if (!success) {\n                _context4.next = 31;\n                break;\n              }\n\n              _message.success('Saved successfully');\n\n              _context4.next = 29;\n              return put({\n                type: 'changeFormVisible',\n                payload: false\n              });\n\n            case 29:\n              _context4.next = 31;\n              return put({\n                type: 'fetch'\n              });\n\n            case 31:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, submit);\n    }),\n    del: /*#__PURE__*/_regeneratorRuntime.mark(function del(_ref9, _ref10) {\n      var payload, call, put, response;\n      return _regeneratorRuntime.wrap(function del$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              payload = _ref9.payload;\n              call = _ref10.call, put = _ref10.put;\n              _context5.next = 4;\n              return call(roleService.del, payload.id);\n\n            case 4:\n              response = _context5.sent;\n\n              if (!(response.status === 'OK')) {\n                _context5.next = 9;\n                break;\n              }\n\n              _message.success('删除成功');\n\n              _context5.next = 9;\n              return put({\n                type: 'fetch'\n              });\n\n            case 9:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, del);\n    }),\n    fetchSelect: /*#__PURE__*/_regeneratorRuntime.mark(function fetchSelect(_, _ref11) {\n      var call, put, response;\n      return _regeneratorRuntime.wrap(function fetchSelect$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              call = _ref11.call, put = _ref11.put;\n              _context6.next = 3;\n              return call(roleService.querySelect);\n\n            case 3:\n              response = _context6.sent;\n              _context6.next = 6;\n              return put({\n                type: 'saveSelectData',\n                payload: response.list || []\n              });\n\n            case 6:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, fetchSelect);\n    }),\n    changeStatus: /*#__PURE__*/_regeneratorRuntime.mark(function changeStatus(_ref12, _ref13) {\n      var payload, call, put, select, response, msg, data, newData, i, item;\n      return _regeneratorRuntime.wrap(function changeStatus$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              payload = _ref12.payload;\n              call = _ref13.call, put = _ref13.put, select = _ref13.select;\n\n              if (!(payload.status === 1)) {\n                _context7.next = 8;\n                break;\n              }\n\n              _context7.next = 5;\n              return call(roleService.enable, payload.id);\n\n            case 5:\n              response = _context7.sent;\n              _context7.next = 11;\n              break;\n\n            case 8:\n              _context7.next = 10;\n              return call(roleService.disable, payload.id);\n\n            case 10:\n              response = _context7.sent;\n\n            case 11:\n              if (!(response.status === 'OK')) {\n                _context7.next = 22;\n                break;\n              }\n\n              msg = '启用成功';\n\n              if (payload.status === 2) {\n                msg = '停用成功';\n              }\n\n              _message.success(msg);\n\n              _context7.next = 17;\n              return select(function (state) {\n                return state.role.data;\n              });\n\n            case 17:\n              data = _context7.sent;\n              newData = {\n                list: [],\n                pagination: data.pagination\n              };\n\n              for (i = 0; i < data.list.length; i += 1) {\n                item = data.list[i];\n\n                if (item.id === payload.id) {\n                  item.status = payload.status;\n                }\n\n                newData.list.push(item);\n              }\n\n              _context7.next = 22;\n              return put({\n                type: 'saveData',\n                payload: newData\n              });\n\n            case 22:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, changeStatus);\n    })\n  },\n  reducers: {\n    saveData: function saveData(state, _ref14) {\n      var payload = _ref14.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        data: payload\n      });\n    },\n    saveSearch: function saveSearch(state, _ref15) {\n      var payload = _ref15.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        search: payload\n      });\n    },\n    savePagination: function savePagination(state, _ref16) {\n      var payload = _ref16.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        pagination: payload\n      });\n    },\n    changeFormVisible: function changeFormVisible(state, _ref17) {\n      var payload = _ref17.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        formVisible: payload\n      });\n    },\n    saveFormTitle: function saveFormTitle(state, _ref18) {\n      var payload = _ref18.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        formTitle: payload\n      });\n    },\n    saveFormType: function saveFormType(state, _ref19) {\n      var payload = _ref19.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        formType: payload\n      });\n    },\n    saveFormID: function saveFormID(state, _ref20) {\n      var payload = _ref20.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        formID: payload\n      });\n    },\n    saveFormData: function saveFormData(state, _ref21) {\n      var payload = _ref21.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        formData: payload\n      });\n    },\n    changeSubmitting: function changeSubmitting(state, _ref22) {\n      var payload = _ref22.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        submitting: payload\n      });\n    },\n    saveSelectData: function saveSelectData(state, _ref23) {\n      var payload = _ref23.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        selectData: payload\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}