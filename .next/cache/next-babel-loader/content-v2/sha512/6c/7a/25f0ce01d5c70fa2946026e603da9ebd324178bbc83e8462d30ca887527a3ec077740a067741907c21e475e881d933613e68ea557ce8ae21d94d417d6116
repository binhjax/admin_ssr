{"ast":null,"code":"import { Action, InputType, MoveItemsState } from '@projectstorm/react-canvas-core';\nimport * as _ from 'lodash';\nimport { PointModel } from '../entities/link/PointModel';\nimport { PortModel } from '../entities/port/PortModel';\nexport class DragDiagramItemsState extends MoveItemsState {\n  constructor() {\n    super();\n    this.registerAction(new Action({\n      type: InputType.MOUSE_UP,\n      fire: event => {\n        const item = this.engine.getMouseElement(event.event);\n\n        if (item instanceof PortModel) {\n          _.forEach(this.initialPositions, position => {\n            if (position.item instanceof PointModel) {\n              const link = position.item.getParent(); // only care about the last links\n\n              if (link.getLastPoint() !== position.item) {\n                return;\n              }\n\n              if (link.getSourcePort().canLinkToPort(item)) {\n                link.setTargetPort(item);\n                item.reportPosition();\n                this.engine.repaintCanvas();\n              }\n            }\n          });\n        }\n      }\n    }));\n  }\n\n}","map":{"version":3,"sources":["/home/tuanquang/admin_ssr/src/components/Test/state/DragDiagramItemsState.ts"],"names":["Action","InputType","MoveItemsState","_","PointModel","PortModel","DragDiagramItemsState","constructor","registerAction","type","MOUSE_UP","fire","event","item","engine","getMouseElement","forEach","initialPositions","position","link","getParent","getLastPoint","getSourcePort","canLinkToPort","setTargetPort","reportPosition","repaintCanvas"],"mappings":"AAAA,SAASA,MAAT,EAA8BC,SAA9B,EAAyCC,cAAzC,QAA+D,iCAA/D;AACA,OAAO,KAAKC,CAAZ,MAAmB,QAAnB;AACA,SAASC,UAAT,QAA2B,6BAA3B;AAEA,SAASC,SAAT,QAA0B,4BAA1B;AAIA,OAAO,MAAMC,qBAAN,SAAoCJ,cAApC,CAAkE;AACxEK,EAAAA,WAAW,GAAG;AACb;AACA,SAAKC,cAAL,CACC,IAAIR,MAAJ,CAAW;AACVS,MAAAA,IAAI,EAAER,SAAS,CAACS,QADN;AAEVC,MAAAA,IAAI,EAAGC,KAAD,IAAoC;AACzC,cAAMC,IAAI,GAAG,KAAKC,MAAL,CAAYC,eAAZ,CAA4BH,KAAK,CAACA,KAAlC,CAAb;;AACA,YAAIC,IAAI,YAAYR,SAApB,EAA+B;AAC9BF,UAAAA,CAAC,CAACa,OAAF,CAAU,KAAKC,gBAAf,EAAkCC,QAAD,IAAc;AAC9C,gBAAIA,QAAQ,CAACL,IAAT,YAAyBT,UAA7B,EAAyC;AACxC,oBAAMe,IAAI,GAAGD,QAAQ,CAACL,IAAT,CAAcO,SAAd,EAAb,CADwC,CAGxC;;AACA,kBAAID,IAAI,CAACE,YAAL,OAAwBH,QAAQ,CAACL,IAArC,EAA2C;AAC1C;AACA;;AACD,kBAAIM,IAAI,CAACG,aAAL,GAAqBC,aAArB,CAAmCV,IAAnC,CAAJ,EAA8C;AAC7CM,gBAAAA,IAAI,CAACK,aAAL,CAAmBX,IAAnB;AACAA,gBAAAA,IAAI,CAACY,cAAL;AACA,qBAAKX,MAAL,CAAYY,aAAZ;AACA;AACD;AACD,WAdD;AAeA;AACD;AArBS,KAAX,CADD;AAyBA;;AA5BuE","sourcesContent":["import { Action, ActionEvent, InputType, MoveItemsState } from '@projectstorm/react-canvas-core';\nimport * as _ from 'lodash';\nimport { PointModel } from '../entities/link/PointModel';\nimport { DiagramEngine } from '../DiagramEngine';\nimport { PortModel } from '../entities/port/PortModel';\nimport { MouseEvent } from 'react';\nimport { CustomLinkModel } from '../CustomLinkModel';\n\nexport class DragDiagramItemsState extends MoveItemsState<DiagramEngine> {\n\tconstructor() {\n\t\tsuper();\n\t\tthis.registerAction(\n\t\t\tnew Action({\n\t\t\t\ttype: InputType.MOUSE_UP,\n\t\t\t\tfire: (event: ActionEvent<MouseEvent>) => {\n\t\t\t\t\tconst item = this.engine.getMouseElement(event.event);\n\t\t\t\t\tif (item instanceof PortModel) {\n\t\t\t\t\t\t_.forEach(this.initialPositions, (position) => {\n\t\t\t\t\t\t\tif (position.item instanceof PointModel) {\n\t\t\t\t\t\t\t\tconst link = position.item.getParent() as CustomLinkModel;\n\n\t\t\t\t\t\t\t\t// only care about the last links\n\t\t\t\t\t\t\t\tif (link.getLastPoint() !== position.item) {\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (link.getSourcePort().canLinkToPort(item)) {\n\t\t\t\t\t\t\t\t\tlink.setTargetPort(item);\n\t\t\t\t\t\t\t\t\titem.reportPosition();\n\t\t\t\t\t\t\t\t\tthis.engine.repaintCanvas();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}