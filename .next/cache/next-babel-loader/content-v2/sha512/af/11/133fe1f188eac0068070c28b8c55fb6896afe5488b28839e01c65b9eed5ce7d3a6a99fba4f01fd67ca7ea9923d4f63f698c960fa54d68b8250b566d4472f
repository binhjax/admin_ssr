{"ast":null,"code":"import \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/popconfirm/style\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/nguyenthanhbinh/Work/vnshop/admin/src/pages/menu/MenuResource/index.js\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { PureComponent } from 'react';\nimport { newUUID } from '@/utils/utils';\nimport { EditableCell, EditableFormRow } from './EditableCell';\nimport styles from './index.less';\n\nfunction fillKey(data) {\n  if (!data) {\n    return [];\n  }\n\n  return data.map(function (item) {\n    var nitem = _objectSpread({}, item);\n\n    if (!nitem.key) {\n      nitem.key = newUUID();\n    }\n\n    return nitem;\n  });\n}\n\nvar MenuAction = /*#__PURE__*/function (_PureComponent) {\n  _inherits(MenuAction, _PureComponent);\n\n  var _super = _createSuper(MenuAction);\n\n  function MenuAction(props) {\n    var _this;\n\n    _classCallCheck(this, MenuAction);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAddCancel\", function () {\n      _this.setState({\n        addVisible: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDelete\", function (key) {\n      var dataSource = _this.state.dataSource;\n      var data = dataSource.filter(function (item) {\n        return item.key !== key;\n      });\n\n      _this.setState({\n        dataSource: data\n      }, function () {\n        _this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAdd\", function () {\n      var dataSource = _this.state.dataSource;\n      var item = {\n        key: newUUID(),\n        method: '',\n        path: ''\n      };\n      var data = [].concat(_toConsumableArray(dataSource), [item]);\n\n      _this.setState({\n        dataSource: data\n      }, function () {\n        _this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSave\", function (row) {\n      var dataSource = _this.state.dataSource;\n\n      var data = _toConsumableArray(dataSource);\n\n      var index = data.findIndex(function (item) {\n        return row.key === item.key;\n      });\n      var item = data[index];\n      data.splice(index, 1, _objectSpread(_objectSpread({}, item), row));\n\n      _this.setState({\n        dataSource: data\n      }, function () {\n        _this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"triggerChange\", function (data) {\n      var onChange = _this.props.onChange;\n\n      if (onChange) {\n        onChange(data);\n      }\n    });\n\n    _this.columns = [{\n      title: '请求方式',\n      dataIndex: 'method',\n      editable: true,\n      width: '30%'\n    }, {\n      title: '请求路径',\n      dataIndex: 'path',\n      editable: true,\n      width: '45%'\n    }, {\n      title: '操作',\n      dataIndex: 'key',\n      width: '25%',\n      render: function render(_, record) {\n        var dataSource = _this.state.dataSource;\n\n        if (dataSource.length === 0) {\n          return null;\n        }\n\n        return __jsx(_Popconfirm, {\n          title: \"\\u786E\\u5B9A\\u8981\\u5220\\u9664\\u8BE5\\u6570\\u636E\\u5417?\",\n          onConfirm: function onConfirm() {\n            return _this.handleDelete(record.key);\n          },\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 48,\n            columnNumber: 13\n          }\n        }, __jsx(\"a\", {\n          __self: _assertThisInitialized(_this),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 49,\n            columnNumber: 15\n          }\n        }, \"\\u5220\\u9664\"));\n      }\n    }];\n    _this.state = {\n      dataSource: fillKey(props.value),\n      addVisible: false\n    };\n    return _this;\n  }\n\n  _createClass(MenuAction, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var dataSource = this.state.dataSource;\n      var components = {\n        body: {\n          row: EditableFormRow,\n          cell: EditableCell\n        }\n      };\n      var columns = this.columns.map(function (col) {\n        if (!col.editable) {\n          return col;\n        }\n\n        return _objectSpread(_objectSpread({}, col), {}, {\n          onCell: function onCell(record) {\n            return {\n              record: record,\n              editable: col.editable,\n              dataIndex: col.dataIndex,\n              title: col.title,\n              handleSave: _this2.handleSave\n            };\n          }\n        });\n      });\n      return __jsx(\"div\", {\n        className: styles.tableList,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 7\n        }\n      }, __jsx(\"div\", {\n        className: styles.tableListOperator,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 9\n        }\n      }, __jsx(_Button, {\n        onClick: this.handleAdd,\n        size: \"small\",\n        type: \"primary\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 11\n        }\n      }, \"\\u65B0\\u589E\")), __jsx(_Table, {\n        rowKey: function rowKey(record) {\n          return record.key;\n        },\n        components: components,\n        bordered: true,\n        dataSource: dataSource,\n        columns: columns,\n        pagination: false,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 9\n        }\n      }));\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(nextProps, state) {\n      if ('value' in nextProps) {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          dataSource: fillKey(nextProps.value)\n        });\n      }\n\n      return state;\n    }\n  }]);\n\n  return MenuAction;\n}(PureComponent);\n\nexport { MenuAction as default };","map":{"version":3,"sources":["/Users/nguyenthanhbinh/Work/vnshop/admin/src/pages/menu/MenuResource/index.js"],"names":["React","PureComponent","newUUID","EditableCell","EditableFormRow","styles","fillKey","data","map","item","nitem","key","MenuAction","props","setState","addVisible","dataSource","state","filter","triggerChange","method","path","row","index","findIndex","splice","onChange","columns","title","dataIndex","editable","width","render","_","record","length","handleDelete","value","components","body","cell","col","onCell","handleSave","tableList","tableListOperator","handleAdd","nextProps"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\r\nimport { Table, Button, Popconfirm } from 'antd';\r\nimport { newUUID } from '@/utils/utils';\r\nimport { EditableCell, EditableFormRow } from './EditableCell';\r\n\r\nimport styles from './index.less';\r\n\r\nfunction fillKey(data) {\r\n  if (!data) {\r\n    return [];\r\n  }\r\n  return data.map(item => {\r\n    const nitem = { ...item };\r\n    if (!nitem.key) {\r\n      nitem.key = newUUID();\r\n    }\r\n    return nitem;\r\n  });\r\n}\r\n\r\nexport default class MenuAction extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.columns = [\r\n      {\r\n        title: '请求方式',\r\n        dataIndex: 'method',\r\n        editable: true,\r\n        width: '30%',\r\n      },\r\n      {\r\n        title: '请求路径',\r\n        dataIndex: 'path',\r\n        editable: true,\r\n        width: '45%',\r\n      },\r\n      {\r\n        title: '操作',\r\n        dataIndex: 'key',\r\n        width: '25%',\r\n        render: (_, record) => {\r\n          const { dataSource } = this.state;\r\n          if (dataSource.length === 0) {\r\n            return null;\r\n          }\r\n          return (\r\n            <Popconfirm title=\"确定要删除该数据吗?\" onConfirm={() => this.handleDelete(record.key)}>\r\n              <a>删除</a>\r\n            </Popconfirm>\r\n          );\r\n        },\r\n      },\r\n    ];\r\n\r\n    this.state = {\r\n      dataSource: fillKey(props.value),\r\n      addVisible: false,\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromProps(nextProps, state) {\r\n    if ('value' in nextProps) {\r\n      return { ...state, dataSource: fillKey(nextProps.value) };\r\n    }\r\n    return state;\r\n  }\r\n\r\n  handleAddCancel = () => {\r\n    this.setState({ addVisible: false });\r\n  };\r\n\r\n  handleDelete = key => {\r\n    const { dataSource } = this.state;\r\n    const data = dataSource.filter(item => item.key !== key);\r\n    this.setState({ dataSource: data }, () => {\r\n      this.triggerChange(data);\r\n    });\r\n  };\r\n\r\n  handleAdd = () => {\r\n    const { dataSource } = this.state;\r\n    const item = {\r\n      key: newUUID(),\r\n      method: '',\r\n      path: '',\r\n    };\r\n\r\n    const data = [...dataSource, item];\r\n    this.setState(\r\n      {\r\n        dataSource: data,\r\n      },\r\n      () => {\r\n        this.triggerChange(data);\r\n      }\r\n    );\r\n  };\r\n\r\n  handleSave = row => {\r\n    const { dataSource } = this.state;\r\n    const data = [...dataSource];\r\n    const index = data.findIndex(item => row.key === item.key);\r\n    const item = data[index];\r\n    data.splice(index, 1, {\r\n      ...item,\r\n      ...row,\r\n    });\r\n    this.setState({ dataSource: data }, () => {\r\n      this.triggerChange(data);\r\n    });\r\n  };\r\n\r\n  triggerChange = data => {\r\n    const { onChange } = this.props;\r\n    if (onChange) {\r\n      onChange(data);\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { dataSource } = this.state;\r\n    const components = {\r\n      body: {\r\n        row: EditableFormRow,\r\n        cell: EditableCell,\r\n      },\r\n    };\r\n    const columns = this.columns.map(col => {\r\n      if (!col.editable) {\r\n        return col;\r\n      }\r\n      return {\r\n        ...col,\r\n        onCell: record => ({\r\n          record,\r\n          editable: col.editable,\r\n          dataIndex: col.dataIndex,\r\n          title: col.title,\r\n          handleSave: this.handleSave,\r\n        }),\r\n      };\r\n    });\r\n    return (\r\n      <div className={styles.tableList}>\r\n        <div className={styles.tableListOperator}>\r\n          <Button onClick={this.handleAdd} size=\"small\" type=\"primary\">\r\n            新增\r\n          </Button>\r\n        </div>\r\n        <Table\r\n          rowKey={record => record.key}\r\n          components={components}\r\n          bordered\r\n          dataSource={dataSource}\r\n          columns={columns}\r\n          pagination={false}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}