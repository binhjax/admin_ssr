{"ast":null,"code":"import _defineProperty from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/regenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// import { history } from 'umi';\nimport { parse } from 'qs';\nimport { setToken, logout as _logout } from '@/utils/request';\nimport * as loginService from '@/services/login';\nexport default {\n  namespace: 'login',\n  state: {\n    status: '',\n    tip: '',\n    submitting: false,\n    captchaID: '',\n    captcha: ''\n  },\n  effects: {\n    loadCaptcha: /*#__PURE__*/_regeneratorRuntime.mark(function loadCaptcha(_, _ref) {\n      var call, put, response, captchaID;\n      return _regeneratorRuntime.wrap(function loadCaptcha$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              call = _ref.call, put = _ref.put;\n              _context.next = 3;\n              return call(loginService.captchaID);\n\n            case 3:\n              response = _context.sent;\n              captchaID = response.captcha_id;\n              _context.next = 7;\n              return put({\n                type: 'saveCaptchaID',\n                payload: captchaID\n              });\n\n            case 7:\n              _context.next = 9;\n              return put({\n                type: 'saveCaptcha',\n                payload: loginService.captcha(captchaID)\n              });\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, loadCaptcha);\n    }),\n    reloadCaptcha: /*#__PURE__*/_regeneratorRuntime.mark(function reloadCaptcha(_, _ref2) {\n      var put, select, captchaID;\n      return _regeneratorRuntime.wrap(function reloadCaptcha$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              put = _ref2.put, select = _ref2.select;\n              _context2.next = 3;\n              return select(function (state) {\n                return state.login.captchaID;\n              });\n\n            case 3:\n              captchaID = _context2.sent;\n              _context2.next = 6;\n              return put({\n                type: 'saveCaptcha',\n                payload: \"\".concat(loginService.captcha(captchaID), \"&reload=\").concat(Math.random())\n              });\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, reloadCaptcha);\n    }),\n    submit: /*#__PURE__*/_regeneratorRuntime.mark(function submit(_ref3, _ref4) {\n      var payload, call, put, response, message, status, params, redirect;\n      return _regeneratorRuntime.wrap(function submit$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              payload = _ref3.payload;\n              call = _ref4.call, put = _ref4.put;\n              _context3.next = 4;\n              return put({\n                type: 'changeSubmitting',\n                payload: true\n              });\n\n            case 4:\n              _context3.next = 6;\n              return call(loginService.login, payload);\n\n            case 6:\n              response = _context3.sent;\n\n              if (!(response.data && response.data.error)) {\n                _context3.next = 12;\n                break;\n              }\n\n              message = response.data.error.message, status = response.status;\n              _context3.next = 11;\n              return [put({\n                type: 'saveTip',\n                payload: message\n              }), put({\n                type: 'saveStatus',\n                payload: status >= 500 ? 'ERROR' : 'FAIL'\n              }), put({\n                type: 'changeSubmitting',\n                payload: false\n              }), put({\n                type: 'loadCaptcha'\n              })];\n\n            case 11:\n              return _context3.abrupt(\"return\");\n\n            case 12:\n              // 保存访问令牌\n              setToken(response);\n              _context3.next = 15;\n              return [put({\n                type: 'saveTip',\n                payload: ''\n              }), put({\n                type: 'saveStatus',\n                payload: ''\n              }), put({\n                type: 'changeSubmitting',\n                payload: false\n              })];\n\n            case 15:\n              params = parse(window.location.href.split('?')[1]);\n              redirect = params.redirect;\n\n              if (!redirect) {\n                _context3.next = 20;\n                break;\n              }\n\n              window.location.href = redirect;\n              return _context3.abrupt(\"return\");\n\n            case 20:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, submit);\n    }),\n    logout: /*#__PURE__*/_regeneratorRuntime.mark(function logout(_, _ref5) {\n      var call, response;\n      return _regeneratorRuntime.wrap(function logout$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              call = _ref5.call;\n              _context4.next = 3;\n              return call(loginService.logout);\n\n            case 3:\n              response = _context4.sent;\n\n              if (response.status === 'OK') {\n                _logout();\n              }\n\n            case 5:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, logout);\n    })\n  },\n  reducers: {\n    saveCaptchaID: function saveCaptchaID(state, _ref6) {\n      var payload = _ref6.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        captchaID: payload\n      });\n    },\n    saveCaptcha: function saveCaptcha(state, _ref7) {\n      var payload = _ref7.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        captcha: payload\n      });\n    },\n    saveStatus: function saveStatus(state, _ref8) {\n      var payload = _ref8.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        status: payload\n      });\n    },\n    saveTip: function saveTip(state, _ref9) {\n      var payload = _ref9.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        tip: payload\n      });\n    },\n    changeSubmitting: function changeSubmitting(state, _ref10) {\n      var payload = _ref10.payload;\n      return _objectSpread(_objectSpread({}, state), {}, {\n        submitting: payload\n      });\n    }\n  }\n};","map":{"version":3,"sources":["/home/tuanquang/admin_ssr/src/models/login.js"],"names":["parse","setToken","logout","loginService","namespace","state","status","tip","submitting","captchaID","captcha","effects","loadCaptcha","_","call","put","response","captcha_id","type","payload","reloadCaptcha","select","login","Math","random","submit","data","error","message","params","window","location","href","split","redirect","reducers","saveCaptchaID","saveCaptcha","saveStatus","saveTip","changeSubmitting"],"mappings":"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","sourcesContent":["// import { history } from 'umi';\nimport { parse } from 'qs';\nimport { setToken, logout } from '@/utils/request';\nimport * as loginService from '@/services/login';\n\nexport default {\n  namespace: 'login',\n\n  state: {\n    status: '',\n    tip: '',\n    submitting: false,\n    captchaID: '',\n    captcha: '',\n  },\n\n  effects: {\n    *loadCaptcha(_, { call, put }) {\n      const response = yield call(loginService.captchaID);\n      const { captcha_id: captchaID } = response;\n\n      yield put({\n        type: 'saveCaptchaID',\n        payload: captchaID,\n      });\n      yield put({\n        type: 'saveCaptcha',\n        payload: loginService.captcha(captchaID),\n      });\n    },\n    *reloadCaptcha(_, { put, select }) {\n      const captchaID = yield select(state => state.login.captchaID);\n      yield put({\n        type: 'saveCaptcha',\n        payload: `${loginService.captcha(captchaID)}&reload=${Math.random()}`,\n      });\n    },\n    *submit({ payload }, { call, put }) {\n      yield put({\n        type: 'changeSubmitting',\n        payload: true,\n      });\n      const response = yield call(loginService.login, payload);\n      if (response.data && response.data.error) {\n        const {\n          data: {\n            error: { message },\n          },\n          status,\n        } = response;\n        yield [\n          put({\n            type: 'saveTip',\n            payload: message,\n          }),\n          put({\n            type: 'saveStatus',\n            payload: status >= 500 ? 'ERROR' : 'FAIL',\n          }),\n          put({\n            type: 'changeSubmitting',\n            payload: false,\n          }),\n          put({\n            type: 'loadCaptcha',\n          }),\n        ];\n        return;\n      }\n\n      // 保存访问令牌\n      setToken(response);\n\n      yield [\n        put({\n          type: 'saveTip',\n          payload: '',\n        }),\n        put({\n          type: 'saveStatus',\n          payload: '',\n        }),\n        put({\n          type: 'changeSubmitting',\n          payload: false,\n        }),\n      ];\n\n      const params = parse(window.location.href.split('?')[1]);\n      const { redirect } = params;\n      if (redirect) {\n        window.location.href = redirect;\n        return;\n      }\n      // history.replace('/');\n    },\n    *logout(_, { call }) {\n      const response = yield call(loginService.logout);\n      if (response.status === 'OK') {\n        logout();\n      }\n    },\n  },\n\n  reducers: {\n    saveCaptchaID(state, { payload }) {\n      return {\n        ...state,\n        captchaID: payload,\n      };\n    },\n    saveCaptcha(state, { payload }) {\n      return {\n        ...state,\n        captcha: payload,\n      };\n    },\n    saveStatus(state, { payload }) {\n      return {\n        ...state,\n        status: payload,\n      };\n    },\n    saveTip(state, { payload }) {\n      return {\n        ...state,\n        tip: payload,\n      };\n    },\n    changeSubmitting(state, { payload }) {\n      return {\n        ...state,\n        submitting: payload,\n      };\n    },\n  },\n};\n"]},"metadata":{},"sourceType":"module"}