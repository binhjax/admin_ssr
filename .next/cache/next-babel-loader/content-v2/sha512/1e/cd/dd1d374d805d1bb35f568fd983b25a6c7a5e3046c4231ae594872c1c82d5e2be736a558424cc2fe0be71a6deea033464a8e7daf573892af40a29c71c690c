{"ast":null,"code":"import \"antd/lib/table/style\";\nimport _Table from \"antd/lib/table\";\nimport \"antd/lib/button/style\";\nimport _Button from \"antd/lib/button\";\nimport \"antd/lib/popconfirm/style\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport \"antd/lib/divider/style\";\nimport _Divider from \"antd/lib/divider\";\nvar _jsxFileName = \"/Volumes/ExternalData/Work/vnshop/admin/src/components/Menu/MenuAction/index.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { PureComponent } from 'react';\nimport { newUUID } from '@/utils/utils';\nimport FormDialog from '../FormDialog';\nimport TplDialog from '../TplDialog';\nimport styles from './index.less';\n\nfunction fillKey(data) {\n  if (!data) {\n    return [];\n  }\n\n  return data.map(item => {\n    const nitem = _objectSpread({}, item);\n\n    if (!nitem.key) {\n      nitem.key = newUUID();\n    }\n\n    return nitem;\n  });\n}\n\nexport default class MenuAction extends PureComponent {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", {\n      dataSource: [],\n      formVisible: false,\n      formData: {},\n      tplVisible: false\n    });\n\n    _defineProperty(this, \"handleDelete\", key => {\n      const {\n        dataSource\n      } = this.state;\n      const data = dataSource.filter(item => item.key !== key);\n      this.setState({\n        dataSource: data\n      }, () => {\n        this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(this, \"handleEdit\", item => {\n      this.setState({\n        formVisible: true,\n        formData: item\n      });\n    });\n\n    _defineProperty(this, \"handleFormCancel\", () => {\n      this.setState({\n        formVisible: false\n      });\n    });\n\n    _defineProperty(this, \"handleFormSubmit\", formData => {\n      const {\n        dataSource\n      } = this.state;\n      const data = [...dataSource];\n      let exists = false;\n\n      for (let i = 0; i < data.length; i += 1) {\n        if (data[i].code === formData.code) {\n          exists = true;\n          data[i] = _objectSpread({\n            key: formData.code\n          }, formData);\n          break;\n        }\n      }\n\n      if (!exists) {\n        data.push(_objectSpread({\n          key: formData.code\n        }, formData));\n      }\n\n      this.setState({\n        dataSource: data,\n        formVisible: false\n      }, () => {\n        this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(this, \"handleAdd\", () => {\n      this.setState({\n        formVisible: true,\n        formData: {}\n      });\n    });\n\n    _defineProperty(this, \"handleTplCancel\", () => {\n      this.setState({\n        tplVisible: false\n      });\n    });\n\n    _defineProperty(this, \"handleTplSubmit\", formData => {\n      const {\n        path\n      } = formData;\n      const tplData = [{\n        code: 'add',\n        name: 'Add',\n        resources: [{\n          method: 'POST',\n          path\n        }]\n      }, {\n        code: 'edit',\n        name: 'Edit',\n        resources: [{\n          method: 'GET',\n          path: `${path}/:id`\n        }, {\n          method: 'PUT',\n          path: `${path}/:id`\n        }]\n      }, {\n        code: 'del',\n        name: 'Delete',\n        resources: [{\n          method: 'DELETE',\n          path: `${path}/:id`\n        }]\n      }, {\n        code: 'view',\n        name: 'View',\n        resources: [{\n          method: 'GET',\n          path: `${path}/:id`\n        }]\n      }, {\n        code: 'query',\n        name: 'Query',\n        resources: [{\n          method: 'GET',\n          path\n        }]\n      }];\n      const newData = tplData.map(v => _objectSpread({\n        key: v.code\n      }, v));\n      const {\n        dataSource\n      } = this.state;\n      const data = [...dataSource];\n      const mDataSource = data.reduce((m, cur) => {\n        const nm = _objectSpread({}, m);\n\n        nm[cur.code] = cur;\n        return nm;\n      }, {});\n\n      for (let i = 0; i < newData.length; i += 1) {\n        if (!mDataSource[newData[i].key]) {\n          data.push(_objectSpread({}, newData[i]));\n        }\n      }\n\n      this.setState({\n        dataSource: data,\n        tplVisible: false\n      }, () => {\n        this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(this, \"handleTplAdd\", () => {\n      this.setState({\n        tplVisible: true\n      });\n    });\n\n    _defineProperty(this, \"handleSave\", row => {\n      const {\n        dataSource\n      } = this.state;\n      const data = [...dataSource];\n      const index = data.findIndex(item => row.key === item.key);\n      const item = data[index];\n      data.splice(index, 1, _objectSpread(_objectSpread({}, item), row));\n      this.setState({\n        dataSource: data\n      }, () => {\n        this.triggerChange(data);\n      });\n    });\n\n    _defineProperty(this, \"triggerChange\", data => {\n      const {\n        onChange\n      } = this.props;\n\n      if (onChange) {\n        onChange(data);\n      }\n    });\n  }\n\n  static getDerivedStateFromProps(nextProps, state) {\n    if ('value' in nextProps) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        dataSource: fillKey(nextProps.value)\n      });\n    }\n\n    return state;\n  }\n\n  render() {\n    const {\n      dataSource,\n      tplVisible,\n      formData,\n      formVisible\n    } = this.state;\n    const columns = [{\n      title: 'Code',\n      dataIndex: 'code',\n      width: '35%'\n    }, {\n      title: 'Action Name',\n      dataIndex: 'name',\n      width: '35%'\n    }, {\n      title: 'Key',\n      dataIndex: 'key',\n      width: '30%',\n      render: (_, record) => {\n        return [__jsx(\"a\", {\n          href: \"#\",\n          onClick: () => this.handleEdit(record),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 13\n          }\n        }, \"Edit\"), __jsx(_Divider, {\n          type: \"vertical\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 13\n          }\n        }), __jsx(_Popconfirm, {\n          title: \"Are you sure you want to delete this data?\",\n          onConfirm: () => this.handleDelete(record.key),\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 13\n          }\n        }, __jsx(\"a\", {\n          href: \"#\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 193,\n            columnNumber: 15\n          }\n        }, \"Delete\"))];\n      }\n    }];\n    return __jsx(\"div\", {\n      className: styles.tableList,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 7\n      }\n    }, __jsx(\"div\", {\n      className: styles.tableListOperator,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 9\n      }\n    }, __jsx(_Button, {\n      onClick: this.handleAdd,\n      size: \"small\",\n      type: \"primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 11\n      }\n    }, \"Add\"), __jsx(_Button, {\n      onClick: this.handleTplAdd,\n      size: \"small\",\n      type: \"primary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 11\n      }\n    }, \"Quick template\")), __jsx(_Table, {\n      rowKey: record => record.key,\n      bordered: true,\n      dataSource: dataSource,\n      columns: columns,\n      pagination: false,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 9\n      }\n    }), __jsx(TplDialog, {\n      visible: tplVisible,\n      onSubmit: this.handleTplSubmit,\n      onCancel: this.handleTplCancel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 9\n      }\n    }), __jsx(FormDialog, {\n      visible: formVisible,\n      formData: formData,\n      onSubmit: this.handleFormSubmit,\n      onCancel: this.handleFormCancel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}","map":{"version":3,"sources":["/Volumes/ExternalData/Work/vnshop/admin/src/components/Menu/MenuAction/index.js"],"names":["React","PureComponent","newUUID","FormDialog","TplDialog","styles","fillKey","data","map","item","nitem","key","MenuAction","dataSource","formVisible","formData","tplVisible","state","filter","setState","triggerChange","exists","i","length","code","push","path","tplData","name","resources","method","newData","v","mDataSource","reduce","m","cur","nm","row","index","findIndex","splice","onChange","props","getDerivedStateFromProps","nextProps","value","render","columns","title","dataIndex","width","_","record","handleEdit","handleDelete","tableList","tableListOperator","handleAdd","handleTplAdd","handleTplSubmit","handleTplCancel","handleFormSubmit","handleFormCancel"],"mappings":"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","sourcesContent":["import React, { PureComponent } from 'react';\nimport { Table, Button, Popconfirm, Divider } from 'antd';\nimport { newUUID } from '@/utils/utils';\nimport FormDialog from '../FormDialog';\nimport TplDialog from '../TplDialog';\nimport styles from './index.less';\n\nfunction fillKey(data) {\n  if (!data) {\n    return [];\n  }\n  return data.map(item => {\n    const nitem = { ...item };\n    if (!nitem.key) {\n      nitem.key = newUUID();\n    }\n    return nitem;\n  });\n}\n\nexport default class MenuAction extends PureComponent {\n  state = {\n    dataSource: [],\n    formVisible: false,\n    formData: {},\n    tplVisible: false,\n  };\n\n  static getDerivedStateFromProps(nextProps, state) {\n    if ('value' in nextProps) {\n      return {\n        ...state,\n        dataSource: fillKey(nextProps.value),\n      };\n    }\n    return state;\n  }\n\n  handleDelete = key => {\n    const { dataSource } = this.state;\n    const data = dataSource.filter(item => item.key !== key);\n    this.setState({ dataSource: data }, () => {\n      this.triggerChange(data);\n    });\n  };\n\n  handleEdit = item => {\n    this.setState({\n      formVisible: true,\n      formData: item,\n    });\n  };\n\n  handleFormCancel = () => {\n    this.setState({ formVisible: false });\n  };\n\n  handleFormSubmit = formData => {\n    const { dataSource } = this.state;\n    const data = [...dataSource];\n    let exists = false;\n    for (let i = 0; i < data.length; i += 1) {\n      if (data[i].code === formData.code) {\n        exists = true;\n        data[i] = { key: formData.code, ...formData };\n        break;\n      }\n    }\n    if (!exists) {\n      data.push({ key: formData.code, ...formData });\n    }\n    this.setState({ dataSource: data, formVisible: false }, () => {\n      this.triggerChange(data);\n    });\n  };\n\n  handleAdd = () => {\n    this.setState({ formVisible: true, formData: {} });\n  };\n\n  handleTplCancel = () => {\n    this.setState({ tplVisible: false });\n  };\n\n  handleTplSubmit = formData => {\n    const { path } = formData;\n    const tplData = [\n      {\n        code: 'add',\n        name: 'Add',\n        resources: [{ method: 'POST', path }],\n      },\n      {\n        code: 'edit',\n        name: 'Edit',\n        resources: [{ method: 'GET', path: `${path}/:id` }, { method: 'PUT', path: `${path}/:id` }],\n      },\n      {\n        code: 'del',\n        name: 'Delete',\n        resources: [{ method: 'DELETE', path: `${path}/:id` }],\n      },\n      {\n        code: 'view',\n        name: 'View',\n        resources: [{ method: 'GET', path: `${path}/:id` }],\n      },\n      {\n        code: 'query',\n        name: 'Query',\n        resources: [{ method: 'GET', path }],\n      },\n    ];\n\n    const newData = tplData.map(v => ({ key: v.code, ...v }));\n    const { dataSource } = this.state;\n    const data = [...dataSource];\n    const mDataSource = data.reduce((m, cur) => {\n      const nm = { ...m };\n      nm[cur.code] = cur;\n      return nm;\n    }, {});\n    for (let i = 0; i < newData.length; i += 1) {\n      if (!mDataSource[newData[i].key]) {\n        data.push({ ...newData[i] });\n      }\n    }\n\n    this.setState(\n      {\n        dataSource: data,\n        tplVisible: false,\n      },\n      () => {\n        this.triggerChange(data);\n      }\n    );\n  };\n\n  handleTplAdd = () => {\n    this.setState({ tplVisible: true });\n  };\n\n  handleSave = row => {\n    const { dataSource } = this.state;\n    const data = [...dataSource];\n    const index = data.findIndex(item => row.key === item.key);\n    const item = data[index];\n    data.splice(index, 1, {\n      ...item,\n      ...row,\n    });\n    this.setState({ dataSource: data }, () => {\n      this.triggerChange(data);\n    });\n  };\n\n  triggerChange = data => {\n    const { onChange } = this.props;\n    if (onChange) {\n      onChange(data);\n    }\n  };\n\n  render() {\n    const { dataSource, tplVisible, formData, formVisible } = this.state;\n\n    const columns = [\n      {\n        title: 'Code',\n        dataIndex: 'code',\n        width: '35%',\n      },\n      {\n        title: 'Action Name',\n        dataIndex: 'name',\n        width: '35%',\n      },\n      {\n        title: 'Key',\n        dataIndex: 'key',\n        width: '30%',\n        render: (_, record) => {\n          return [\n            <a href=\"#\" onClick={() => this.handleEdit(record)}>\n              Edit\n            </a>,\n            <Divider type=\"vertical\" />,\n            <Popconfirm\n              title=\"Are you sure you want to delete this data?\"\n              onConfirm={() => this.handleDelete(record.key)}\n            >\n              <a href=\"#\">Delete</a>\n            </Popconfirm>,\n          ];\n        },\n      },\n    ];\n\n    return (\n      <div className={styles.tableList}>\n        <div className={styles.tableListOperator}>\n          <Button onClick={this.handleAdd} size=\"small\" type=\"primary\">\n            Add\n          </Button>\n          <Button onClick={this.handleTplAdd} size=\"small\" type=\"primary\">\n            Quick template\n          </Button>\n        </div>\n        <Table\n          rowKey={record => record.key}\n          bordered\n          dataSource={dataSource}\n          columns={columns}\n          pagination={false}\n        />\n        <TplDialog\n          visible={tplVisible}\n          onSubmit={this.handleTplSubmit}\n          onCancel={this.handleTplCancel}\n        />\n        <FormDialog\n          visible={formVisible}\n          formData={formData}\n          onSubmit={this.handleFormSubmit}\n          onCancel={this.handleFormCancel}\n        />\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}