{"ast":null,"code":"import _taggedTemplateLiteral from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _classCallCheck from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/home/tuanquang/admin_ssr/src/components/Test/LabelWidget.tsx\";\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    pointer-events: none;\\n    overflow: visible;\\n  \"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    display: inline-block;\\n    position: absolute;\\n  \"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport * as React from 'react';\nimport styled from '@emotion/styled';\nvar S;\n\n(function (_S) {\n  var Label = _S.Label = styled.div(_templateObject());\n  var Foreign = _S.Foreign = styled.foreignObject(_templateObject2());\n})(S || (S = {}));\n\nexport var LabelWidget = /*#__PURE__*/function (_React$Component) {\n  _inherits(LabelWidget, _React$Component);\n\n  var _super = _createSuper(LabelWidget);\n\n  function LabelWidget(props) {\n    var _this;\n\n    _classCallCheck(this, LabelWidget);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"ref\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"calculateLabelPosition\", function () {\n      var _found = found,\n          path = _found.path,\n          position = _found.position;\n      var labelDimensions = {\n        width: _this.ref.current.offsetWidth,\n        height: _this.ref.current.offsetHeight\n      };\n      var pathCentre = path.getPointAtLength(position);\n      var labelCoordinates = {\n        x: pathCentre.x - labelDimensions.width / 2 + _this.props.label.getOptions().offsetX,\n        y: pathCentre.y - labelDimensions.height / 2 + _this.props.label.getOptions().offsetY\n      };\n      _this.ref.current.style.transform = \"translate(\".concat(labelCoordinates.x, \"px, \").concat(labelCoordinates.y, \"px)\");\n    });\n\n    _this.ref = /*#__PURE__*/React.createRef();\n    return _this;\n  }\n\n  _createClass(LabelWidget, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      window.requestAnimationFrame(this.calculateLabelPosition);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.requestAnimationFrame(this.calculateLabelPosition);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var canvas = this.props.engine.getCanvas();\n      return /*#__PURE__*/_jsxDEV(S.Foreign, {\n        width: canvas.offsetWidth,\n        height: canvas.offsetHeight,\n        children: /*#__PURE__*/_jsxDEV(S.Label, {\n          ref: this.ref,\n          children: this.props.engine.getFactoryForLabel(this.props.label).generateReactWidget({\n            model: this.props.label\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 9\n        }, this)\n      }, this.props.label.getID(), false, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 7\n      }, this);\n    }\n  }]);\n\n  return LabelWidget;\n}(React.Component);","map":{"version":3,"sources":["/home/tuanquang/admin_ssr/src/components/Test/LabelWidget.tsx"],"names":["React","styled","Label","div","Foreign","foreignObject","S","LabelWidget","props","found","path","position","labelDimensions","width","ref","current","offsetWidth","height","offsetHeight","pathCentre","getPointAtLength","labelCoordinates","x","label","getOptions","offsetX","y","offsetY","style","transform","createRef","window","requestAnimationFrame","calculateLabelPosition","canvas","engine","getCanvas","getFactoryForLabel","generateReactWidget","model","getID","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AAGA,OAAOC,MAAP,MAAmB,iBAAnB;;;;AASS,MAAMC,KAAK,cAAGD,MAAM,CAACE,GAAV,mBAAX;AAKA,MAAMC,OAAO,gBAAGH,MAAM,CAACI,aAAV,oBAAb;GANCC,C,KAAAA,C;;AAYV,WAAaC,WAAb;AAAA;;AAAA;;AAGE,uBAAYC,KAAZ,EAAqC;AAAA;;AAAA;;AACnC,8BAAMA,KAAN;;AADmC;;AAAA,6EAaZ,YAAM;AAAA,mBACFC,KADE;AAAA,UACrBC,IADqB,UACrBA,IADqB;AAAA,UACfC,QADe,UACfA,QADe;AAG7B,UAAMC,eAAe,GAAG;AACtBC,QAAAA,KAAK,EAAE,MAAKC,GAAL,CAASC,OAAT,CAAiBC,WADF;AAEtBC,QAAAA,MAAM,EAAE,MAAKH,GAAL,CAASC,OAAT,CAAiBG;AAFH,OAAxB;AAKA,UAAMC,UAAU,GAAGT,IAAI,CAACU,gBAAL,CAAsBT,QAAtB,CAAnB;AAEA,UAAMU,gBAAgB,GAAG;AACvBC,QAAAA,CAAC,EAAEH,UAAU,CAACG,CAAX,GAAeV,eAAe,CAACC,KAAhB,GAAwB,CAAvC,GAA2C,MAAKL,KAAL,CAAWe,KAAX,CAAiBC,UAAjB,GAA8BC,OADrD;AAEvBC,QAAAA,CAAC,EAAEP,UAAU,CAACO,CAAX,GAAed,eAAe,CAACK,MAAhB,GAAyB,CAAxC,GAA4C,MAAKT,KAAL,CAAWe,KAAX,CAAiBC,UAAjB,GAA8BG;AAFtD,OAAzB;AAKA,YAAKb,GAAL,CAASC,OAAT,CAAiBa,KAAjB,CAAuBC,SAAvB,uBAAgDR,gBAAgB,CAACC,CAAjE,iBAAyED,gBAAgB,CAACK,CAA1F;AACD,KA7BoC;;AAEnC,UAAKZ,GAAL,gBAAWd,KAAK,CAAC8B,SAAN,EAAX;AAFmC;AAGpC;;AANH;AAAA;AAAA,yCAQuB;AACnBC,MAAAA,MAAM,CAACC,qBAAP,CAA6B,KAAKC,sBAAlC;AACD;AAVH;AAAA;AAAA,wCAYsB;AAClBF,MAAAA,MAAM,CAACC,qBAAP,CAA6B,KAAKC,sBAAlC;AACD;AAdH;AAAA;AAAA,6BAkCW;AACP,UAAMC,MAAM,GAAG,KAAK1B,KAAL,CAAW2B,MAAX,CAAkBC,SAAlB,EAAf;AACA,0BACE,QAAC,CAAD,CAAG,OAAH;AAEE,QAAA,KAAK,EAAEF,MAAM,CAAClB,WAFhB;AAGE,QAAA,MAAM,EAAEkB,MAAM,CAAChB,YAHjB;AAAA,+BAKE,QAAC,CAAD,CAAG,KAAH;AAAS,UAAA,GAAG,EAAE,KAAKJ,GAAnB;AAAA,oBACG,KAAKN,KAAL,CAAW2B,MAAX,CACEE,kBADF,CACqB,KAAK7B,KAAL,CAAWe,KADhC,EAEEe,mBAFF,CAEsB;AAAEC,YAAAA,KAAK,EAAE,KAAK/B,KAAL,CAAWe;AAApB,WAFtB;AADH;AAAA;AAAA;AAAA;AAAA;AALF,SACO,KAAKf,KAAL,CAAWe,KAAX,CAAiBiB,KAAjB,EADP;AAAA;AAAA;AAAA;AAAA,cADF;AAaD;AAjDH;;AAAA;AAAA,EAAiCxC,KAAK,CAACyC,SAAvC","sourcesContent":["import * as React from 'react';\nimport { DiagramEngine } from '@projectstorm/react-diagrams';\nimport { LabelModel } from './LabelModel';\nimport styled from '@emotion/styled';\n\nexport interface LabelWidgetProps {\n  engine: DiagramEngine;\n  label: LabelModel;\n  index: number;\n}\n\nnamespace S {\n  export const Label = styled.div`\n    display: inline-block;\n    position: absolute;\n  `;\n\n  export const Foreign = styled.foreignObject`\n    pointer-events: none;\n    overflow: visible;\n  `;\n}\n\nexport class LabelWidget extends React.Component<LabelWidgetProps> {\n  ref: React.RefObject<HTMLDivElement>;\n\n  constructor(props: LabelWidgetProps) {\n    super(props);\n    this.ref = React.createRef();\n  }\n\n  componentDidUpdate() {\n    window.requestAnimationFrame(this.calculateLabelPosition);\n  }\n\n  componentDidMount() {\n    window.requestAnimationFrame(this.calculateLabelPosition);\n  }\n\n  calculateLabelPosition = () => {\n    const { path, position } = found;\n\n    const labelDimensions = {\n      width: this.ref.current.offsetWidth,\n      height: this.ref.current.offsetHeight,\n    };\n\n    const pathCentre = path.getPointAtLength(position);\n\n    const labelCoordinates = {\n      x: pathCentre.x - labelDimensions.width / 2 + this.props.label.getOptions().offsetX,\n      y: pathCentre.y - labelDimensions.height / 2 + this.props.label.getOptions().offsetY,\n    };\n\n    this.ref.current.style.transform = `translate(${labelCoordinates.x}px, ${labelCoordinates.y}px)`;\n  };\n\n  render() {\n    const canvas = this.props.engine.getCanvas();\n    return (\n      <S.Foreign\n        key={this.props.label.getID()}\n        width={canvas.offsetWidth}\n        height={canvas.offsetHeight}\n      >\n        <S.Label ref={this.ref}>\n          {this.props.engine\n            .getFactoryForLabel(this.props.label)\n            .generateReactWidget({ model: this.props.label })}\n        </S.Label>\n      </S.Foreign>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}