{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport * as loginService from '@/services/login';\nexport default {\n  namespace: 'global',\n  state: {\n    title: 'System Management',\n    copyRight: '2020 Vnpay',\n    defaultURL: '/dashboard',\n    collapsed: false,\n    openKeys: [],\n    selectedKeys: [],\n    user: {\n      user_name: 'admin',\n      real_name: 'Administrator',\n      role_names: []\n    },\n    menuPaths: {},\n    menuMap: {},\n    menus: [],\n    jsonDiagram: ''\n  },\n  effects: {\n    *menuEvent({\n      pathname\n    }, {\n      put,\n      select\n    }) {\n      let p = pathname;\n\n      if (p === '/') {\n        p = yield select(state => state.global.defaultURL);\n      }\n\n      const menuPaths = yield select(state => state.global.menuPaths);\n      const item = menuPaths[p];\n\n      if (!item) {\n        return;\n      }\n\n      if (item.parent_path && item.parent_path !== '') {\n        yield put({\n          type: 'changeOpenKeys',\n          payload: item.parent_path.split('/')\n        });\n      }\n\n      yield put({\n        type: 'changeSelectedKeys',\n        payload: [item.id]\n      });\n    },\n\n    *fetchUser(_, {\n      call,\n      put\n    }) {\n      const response = yield call(loginService.getCurrentUser);\n      yield put({\n        type: 'saveUser',\n        payload: response\n      });\n    },\n\n    *fetchMenuTree({\n      pathname\n    }, {\n      call,\n      put\n    }) {\n      const response = yield call(loginService.queryMenuTree);\n      const menuData = response.list || [];\n      yield put({\n        type: 'saveMenus',\n        payload: menuData\n      });\n      const menuPaths = {};\n      const menuMap = {};\n\n      function fillData(data) {\n        for (let i = 0; i < data.length; i += 1) {\n          menuMap[data[i].id] = data[i];\n\n          if (data[i].router !== '') {\n            menuPaths[data[i].router] = data[i];\n          }\n\n          if (data[i].children && data[i].children.length > 0) {\n            fillData(data[i].children);\n          }\n        }\n      }\n\n      fillData(menuData);\n      yield [put({\n        type: 'saveMenuPaths',\n        payload: menuPaths\n      }), put({\n        type: 'saveMenuMap',\n        payload: menuMap\n      }), put({\n        type: 'menuEvent',\n        pathname\n      })];\n    },\n\n    *setJsonDiagram({\n      json\n    }, {\n      call,\n      put\n    }) {\n      yield put({\n        type: 'setJsonDiagram'\n      });\n    }\n\n  },\n  reducers: {\n    changeLayoutCollapsed(state, {\n      payload\n    }) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        collapsed: payload\n      });\n    },\n\n    changeOpenKeys(state, {\n      payload\n    }) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        openKeys: payload\n      });\n    },\n\n    changeSelectedKeys(state, {\n      payload\n    }) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        selectedKeys: payload\n      });\n    },\n\n    saveUser(state, {\n      payload\n    }) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        user: payload\n      });\n    },\n\n    saveMenuPaths(state, {\n      payload\n    }) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        menuPaths: payload\n      });\n    },\n\n    saveMenuMap(state, {\n      payload\n    }) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        menuMap: payload\n      });\n    },\n\n    saveMenus(state, {\n      payload\n    }) {\n      return _objectSpread(_objectSpread({}, state), {}, {\n        menus: payload\n      });\n    }\n\n  },\n  subscriptions: {\n    setup({\n      dispatch,\n      history\n    }) {\n      if (typeof history !== 'undefined') {\n        history.listen(({\n          pathname\n        }) => {\n          dispatch({\n            type: 'menuEvent',\n            pathname\n          });\n        });\n      }\n    }\n\n  }\n};","map":{"version":3,"sources":["/home/tuanquang/admin_ssr/src/models/global.js"],"names":["loginService","namespace","state","title","copyRight","defaultURL","collapsed","openKeys","selectedKeys","user","user_name","real_name","role_names","menuPaths","menuMap","menus","jsonDiagram","effects","menuEvent","pathname","put","select","p","global","item","parent_path","type","payload","split","id","fetchUser","_","call","response","getCurrentUser","fetchMenuTree","queryMenuTree","menuData","list","fillData","data","i","length","router","children","setJsonDiagram","json","reducers","changeLayoutCollapsed","changeOpenKeys","changeSelectedKeys","saveUser","saveMenuPaths","saveMenuMap","saveMenus","subscriptions","setup","dispatch","history","listen"],"mappings":"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","sourcesContent":["import * as loginService from '@/services/login';\n\nexport default {\n  namespace: 'global',\n\n  state: {\n    title: 'System Management',\n    copyRight: '2020 Vnpay',\n    defaultURL: '/dashboard',\n    collapsed: false,\n    openKeys: [],\n    selectedKeys: [],\n    user: {\n      user_name: 'admin',\n      real_name: 'Administrator',\n      role_names: [],\n    },\n    menuPaths: {},\n    menuMap: {},\n    menus: [],\n    jsonDiagram: '',\n  },\n\n  effects: {\n    *menuEvent({ pathname }, { put, select }) {\n      let p = pathname;\n      if (p === '/') {\n        p = yield select(state => state.global.defaultURL);\n      }\n\n      const menuPaths = yield select(state => state.global.menuPaths);\n      const item = menuPaths[p];\n      if (!item) {\n        return;\n      }\n\n      if (item.parent_path && item.parent_path !== '') {\n        yield put({\n          type: 'changeOpenKeys',\n          payload: item.parent_path.split('/'),\n        });\n      }\n\n      yield put({\n        type: 'changeSelectedKeys',\n        payload: [item.id],\n      });\n    },\n    *fetchUser(_, { call, put }) {\n      const response = yield call(loginService.getCurrentUser);\n      yield put({\n        type: 'saveUser',\n        payload: response,\n      });\n    },\n    *fetchMenuTree({ pathname }, { call, put }) {\n      const response = yield call(loginService.queryMenuTree);\n\n      const menuData = response.list || [];\n      yield put({\n        type: 'saveMenus',\n        payload: menuData,\n      });\n\n      const menuPaths = {};\n      const menuMap = {};\n      function fillData(data) {\n        for (let i = 0; i < data.length; i += 1) {\n          menuMap[data[i].id] = data[i];\n          if (data[i].router !== '') {\n            menuPaths[data[i].router] = data[i];\n          }\n          if (data[i].children && data[i].children.length > 0) {\n            fillData(data[i].children);\n          }\n        }\n      }\n      fillData(menuData);\n\n      yield [\n        put({\n          type: 'saveMenuPaths',\n          payload: menuPaths,\n        }),\n        put({\n          type: 'saveMenuMap',\n          payload: menuMap,\n        }),\n        put({\n          type: 'menuEvent',\n          pathname,\n        }),\n      ];\n    },\n    *setJsonDiagram({ json }, { call, put }) {\n      yield put({\n        type: 'setJsonDiagram',\n      });\n    },\n  },\n\n  reducers: {\n    changeLayoutCollapsed(state, { payload }) {\n      return {\n        ...state,\n        collapsed: payload,\n      };\n    },\n    changeOpenKeys(state, { payload }) {\n      return {\n        ...state,\n        openKeys: payload,\n      };\n    },\n    changeSelectedKeys(state, { payload }) {\n      return {\n        ...state,\n        selectedKeys: payload,\n      };\n    },\n    saveUser(state, { payload }) {\n      return { ...state, user: payload };\n    },\n    saveMenuPaths(state, { payload }) {\n      return { ...state, menuPaths: payload };\n    },\n    saveMenuMap(state, { payload }) {\n      return { ...state, menuMap: payload };\n    },\n    saveMenus(state, { payload }) {\n      return { ...state, menus: payload };\n    },\n  },\n  subscriptions: {\n    setup({ dispatch, history }) {\n      if (typeof history !== 'undefined') {\n        history.listen(({ pathname }) => {\n          dispatch({\n            type: 'menuEvent',\n            pathname,\n          });\n        });\n      }\n    },\n  },\n};\n"]},"metadata":{},"sourceType":"module"}