{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react'; // import dva, { connect } from 'dva';\n\nimport * as core from 'dva-core';\nimport { Provider } from 'react-redux';\nimport model from '../models/index';\n\nconst checkServer = () => Object.prototype.toString.call(global.process) === '[object process]'; // eslint-disable-next-line\n\n\nconst __NEXT_DVA_STORE__ = '__NEXT_DVA_STORE__'; // let history\n// if (typeof document !== 'undefined') {\n//     const createBrowserHistory = require('history/createBrowserHistory').default\n//     history = createBrowserHistory()\n// }\n\nfunction createDvaStore(initialState) {\n  let app;\n\n  if (initialState) {\n    app = dva({\n      initialState\n    });\n  } else {\n    app = dva({});\n  }\n\n  const isArray = Array.isArray(model);\n\n  if (isArray) {\n    model.forEach(m => {\n      app.model(m);\n    });\n  } else {\n    app.model(model);\n  }\n\n  app.router(() => {});\n  app.start(); // console.log(app);\n  // eslint-disable-next-line\n\n  const store = app._store;\n  return store;\n}\n\nfunction getOrCreateStore(initialState) {\n  const isServer = checkServer();\n\n  if (isServer) {\n    // run in server\n    // console.log('server');\n    return createDvaStore(initialState);\n  } // eslint-disable-next-line\n\n\n  if (!window[__NEXT_DVA_STORE__]) {\n    // console.log('client');\n    // eslint-disable-next-line\n    window[__NEXT_DVA_STORE__] = createDvaStore(initialState);\n  } // eslint-disable-next-line\n\n\n  return window[__NEXT_DVA_STORE__];\n}\n\nexport default function withDva(...args) {\n  return function CreateNextPage(Component) {\n    const ComponentWithDva = (props = {}) => {\n      const {\n        store,\n        initialProps,\n        initialState\n      } = props;\n      const ConnectedComponent = connect(...args)(Component);\n      return /*#__PURE__*/React.createElement(Provider, // in client side, it will init store with the initial state tranfer from server side\n      {\n        store: store && store.dispatch ? store : getOrCreateStore(initialState)\n      },\n      /*#__PURE__*/\n      // transfer next.js's props to the page\n      React.createElement(ConnectedComponent, initialProps));\n    };\n\n    ComponentWithDva.getInitialProps = async (props = {}) => {\n      // console.log('get......');\n      const isServer = checkServer();\n      const store = getOrCreateStore(props.req); // call children's getInitialProps\n      // get initProps and transfer in to the page\n\n      const initialProps = Component.getInitialProps ? await Component.getInitialProps(_objectSpread(_objectSpread({}, props), {}, {\n        isServer,\n        store\n      })) : {};\n      return {\n        store,\n        initialProps,\n        initialState: store.getState()\n      };\n    };\n\n    return ComponentWithDva;\n  };\n} // export const storeKeys = {\n//   AccessToken: 'Access-Token',\n// };\n// if (typeof window !== 'undefined') {\n//   export const storeType = {\n//     localStorage,\n//     sessionStorage,\n//   };\n//   const defaultStorage = storeType.localStorage;\n// }\n// function set(key, value, ...options) {\n//   const storage = options.storeType || defaultStorage;\n//   storage.setItem(key, JSON.stringify(value));\n// }\n// function get(key, ...options) {\n//   const storage = options.storeType || defaultStorage;\n//   const value = storage.getItem(key);\n//   return value ? JSON.parse(value) : null;\n// }\n// function remove(key, ...options) {\n//   const storage = options.storeType || defaultStorage;\n//   storage.removeItem(key);\n// }\n// export default {\n//   set,\n//   get,\n//   remove,\n// };","map":{"version":3,"sources":["/Users/nguyenthanhbinh/Work/vnshop/admin/src/utils/store.js"],"names":["React","core","Provider","model","checkServer","Object","prototype","toString","call","global","process","__NEXT_DVA_STORE__","createDvaStore","initialState","app","dva","isArray","Array","forEach","m","router","start","store","_store","getOrCreateStore","isServer","window","withDva","args","CreateNextPage","Component","ComponentWithDva","props","initialProps","ConnectedComponent","connect","createElement","dispatch","getInitialProps","req","getState"],"mappings":"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","sourcesContent":["import React from 'react';\r\n// import dva, { connect } from 'dva';\r\nimport * as core from 'dva-core';\r\n\r\nimport { Provider } from 'react-redux';\r\nimport model from '../models/index';\r\n\r\nconst checkServer = () => Object.prototype.toString.call(global.process) === '[object process]';\r\n\r\n// eslint-disable-next-line\r\nconst __NEXT_DVA_STORE__ = '__NEXT_DVA_STORE__'\r\n\r\n// let history\r\n\r\n// if (typeof document !== 'undefined') {\r\n//     const createBrowserHistory = require('history/createBrowserHistory').default\r\n\r\n//     history = createBrowserHistory()\r\n// }\r\n\r\nfunction createDvaStore(initialState) {\r\n    let app;\r\n    if (initialState) {\r\n        app = dva({\r\n            initialState,\r\n        });\r\n    } else {\r\n        app = dva({});\r\n    }\r\n    const isArray = Array.isArray(model);\r\n    if (isArray) {\r\n        model.forEach((m) => {\r\n            app.model(m);\r\n        });\r\n    } else {\r\n        app.model(model);\r\n    }\r\n    app.router(() => { });\r\n    app.start();\r\n    // console.log(app);\r\n    // eslint-disable-next-line\r\n    const store = app._store\r\n    return store;\r\n}\r\n\r\nfunction getOrCreateStore(initialState) {\r\n    const isServer = checkServer();\r\n    if (isServer) { // run in server\r\n        // console.log('server');\r\n        return createDvaStore(initialState);\r\n    }\r\n    // eslint-disable-next-line\r\n    if (!window[__NEXT_DVA_STORE__]) {\r\n        // console.log('client');\r\n        // eslint-disable-next-line\r\n        window[__NEXT_DVA_STORE__] = createDvaStore(initialState);\r\n    }\r\n    // eslint-disable-next-line\r\n    return window[__NEXT_DVA_STORE__];\r\n}\r\n\r\nexport default function withDva(...args) {\r\n    return function CreateNextPage(Component) {\r\n        const ComponentWithDva = (props = {}) => {\r\n            const { store, initialProps, initialState } = props;\r\n            const ConnectedComponent = connect(...args)(Component);\r\n            return React.createElement(\r\n                Provider,\r\n                // in client side, it will init store with the initial state tranfer from server side\r\n                { store: store && store.dispatch ? store : getOrCreateStore(initialState) },\r\n                // transfer next.js's props to the page\r\n                React.createElement(ConnectedComponent, initialProps),\r\n            );\r\n        };\r\n        ComponentWithDva.getInitialProps = async (props = {}) => {\r\n            // console.log('get......');\r\n            const isServer = checkServer();\r\n            const store = getOrCreateStore(props.req);\r\n            // call children's getInitialProps\r\n            // get initProps and transfer in to the page\r\n            const initialProps = Component.getInitialProps\r\n                ? await Component.getInitialProps({ ...props, isServer, store })\r\n                : {};\r\n            return {\r\n                store,\r\n                initialProps,\r\n                initialState: store.getState(),\r\n            };\r\n        };\r\n        return ComponentWithDva;\r\n    };\r\n}\r\n\r\n// export const storeKeys = {\r\n//   AccessToken: 'Access-Token',\r\n// };\r\n\r\n// if (typeof window !== 'undefined') {\r\n//   export const storeType = {\r\n//     localStorage,\r\n//     sessionStorage,\r\n//   };\r\n\r\n//   const defaultStorage = storeType.localStorage;\r\n// }\r\n\r\n// function set(key, value, ...options) {\r\n//   const storage = options.storeType || defaultStorage;\r\n//   storage.setItem(key, JSON.stringify(value));\r\n// }\r\n\r\n// function get(key, ...options) {\r\n//   const storage = options.storeType || defaultStorage;\r\n//   const value = storage.getItem(key);\r\n//   return value ? JSON.parse(value) : null;\r\n// }\r\n\r\n// function remove(key, ...options) {\r\n//   const storage = options.storeType || defaultStorage;\r\n//   storage.removeItem(key);\r\n// }\r\n\r\n// export default {\r\n//   set,\r\n//   get,\r\n//   remove,\r\n// };\r\n"]},"metadata":{},"sourceType":"module"}