{"ast":null,"code":"import _taggedTemplateLiteral from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _classCallCheck from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/home/tuanquang/admin_ssr/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/home/tuanquang/admin_ssr/src/components/Test/LabelWidget.tsx\";\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n\\t\\tpointer-events: none;\\n\\t\\toverflow: visible;\\n\\t\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n\\t\\tdisplay: inline-block;\\n\\t\\tposition: absolute;\\n\\t\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport * as React from 'react';\nimport styled from '@emotion/styled';\nvar S;\n\n(function (_S) {\n  var Label = _S.Label = styled.div(_templateObject());\n  var Foreign = _S.Foreign = styled.foreignObject(_templateObject2());\n})(S || (S = {}));\n\nexport var LabelWidget = /*#__PURE__*/function (_React$Component) {\n  _inherits(LabelWidget, _React$Component);\n\n  var _super = _createSuper(LabelWidget);\n\n  function LabelWidget(props) {\n    var _this;\n\n    _classCallCheck(this, LabelWidget);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"ref\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"findPathAndRelativePositionToRenderLabel\", function (index) {\n      // an array to hold all path lengths, making sure we hit the DOM only once to fetch this information\n      var link = _this.props.label.getParent();\n\n      var lengths = link.getRenderedPath().map(function (path) {\n        return path.getTotalLength();\n      }); // calculate the point where we want to display the label\n\n      var labelPosition = lengths.reduce(function (previousValue, currentValue) {\n        return previousValue + currentValue;\n      }, 0) * (index / (link.getLabels().length + 1)); // find the path where the label will be rendered and calculate the relative position\n\n      var pathIndex = 0;\n\n      while (pathIndex < link.getRenderedPath().length) {\n        if (labelPosition - lengths[pathIndex] < 0) {\n          return {\n            path: link.getRenderedPath()[pathIndex],\n            position: labelPosition\n          };\n        } // keep searching\n\n\n        labelPosition -= lengths[pathIndex];\n        pathIndex++;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"calculateLabelPosition\", function () {\n      var found = _this.findPathAndRelativePositionToRenderLabel(_this.props.index + 1);\n\n      if (!found) {\n        return;\n      }\n\n      var path = found.path,\n          position = found.position;\n      var labelDimensions = {\n        width: _this.ref.current.offsetWidth,\n        height: _this.ref.current.offsetHeight\n      };\n      var pathCentre = path.getPointAtLength(position);\n      var labelCoordinates = {\n        x: pathCentre.x - labelDimensions.width / 2 + _this.props.label.getOptions().offsetX,\n        y: pathCentre.y - labelDimensions.height / 2 + _this.props.label.getOptions().offsetY\n      };\n      _this.ref.current.style.transform = \"translate(\".concat(labelCoordinates.x, \"px, \").concat(labelCoordinates.y, \"px)\");\n    });\n\n    _this.ref = /*#__PURE__*/React.createRef();\n    return _this;\n  }\n\n  _createClass(LabelWidget, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      window.requestAnimationFrame(this.calculateLabelPosition);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      window.requestAnimationFrame(this.calculateLabelPosition);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var canvas = this.props.engine.getCanvas();\n      return /*#__PURE__*/_jsxDEV(S.Foreign, {\n        width: canvas.offsetWidth,\n        height: canvas.offsetHeight,\n        children: /*#__PURE__*/_jsxDEV(S.Label, {\n          ref: this.ref,\n          children: this.props.engine.getFactoryForLabel(this.props.label).generateReactWidget({\n            model: this.props.label\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 5\n        }, this)\n      }, this.props.label.getID(), false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 4\n      }, this);\n    }\n  }]);\n\n  return LabelWidget;\n}(React.Component);","map":{"version":3,"sources":["/home/tuanquang/admin_ssr/src/components/Test/LabelWidget.tsx"],"names":["React","styled","Label","div","Foreign","foreignObject","S","LabelWidget","props","index","link","label","getParent","lengths","getRenderedPath","map","path","getTotalLength","labelPosition","reduce","previousValue","currentValue","getLabels","length","pathIndex","position","found","findPathAndRelativePositionToRenderLabel","labelDimensions","width","ref","current","offsetWidth","height","offsetHeight","pathCentre","getPointAtLength","labelCoordinates","x","getOptions","offsetX","y","offsetY","style","transform","createRef","window","requestAnimationFrame","calculateLabelPosition","canvas","engine","getCanvas","getFactoryForLabel","generateReactWidget","model","getID","Component"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { DiagramEngine } from '../../DiagramEngine';\nimport { LabelModel } from './LabelModel';\nimport styled from '@emotion/styled';\n\nexport interface LabelWidgetProps {\n\tengine: DiagramEngine;\n\tlabel: LabelModel;\n\tindex: number;\n}\n\nnamespace S {\n\texport const Label = styled.div`\n\t\tdisplay: inline-block;\n\t\tposition: absolute;\n\t`;\n\n\texport const Foreign = styled.foreignObject`\n\t\tpointer-events: none;\n\t\toverflow: visible;\n\t`;\n}\n\nexport class LabelWidget extends React.Component<LabelWidgetProps> {\n\tref: React.RefObject<HTMLDivElement>;\n\n\tconstructor(props: LabelWidgetProps) {\n\t\tsuper(props);\n\t\tthis.ref = React.createRef();\n\t}\n\n\tcomponentDidUpdate() {\n\t\twindow.requestAnimationFrame(this.calculateLabelPosition);\n\t}\n\n\tcomponentDidMount() {\n\t\twindow.requestAnimationFrame(this.calculateLabelPosition);\n\t}\n\n\tfindPathAndRelativePositionToRenderLabel = (index: number): { path: SVGPathElement; position: number } => {\n\t\t// an array to hold all path lengths, making sure we hit the DOM only once to fetch this information\n\t\tconst link = this.props.label.getParent();\n\t\tconst lengths = link.getRenderedPath().map((path) => path.getTotalLength());\n\n\t\t// calculate the point where we want to display the label\n\t\tlet labelPosition =\n\t\t\tlengths.reduce((previousValue, currentValue) => previousValue + currentValue, 0) *\n\t\t\t(index / (link.getLabels().length + 1));\n\n\t\t// find the path where the label will be rendered and calculate the relative position\n\t\tlet pathIndex = 0;\n\t\twhile (pathIndex < link.getRenderedPath().length) {\n\t\t\tif (labelPosition - lengths[pathIndex] < 0) {\n\t\t\t\treturn {\n\t\t\t\t\tpath: link.getRenderedPath()[pathIndex],\n\t\t\t\t\tposition: labelPosition\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// keep searching\n\t\t\tlabelPosition -= lengths[pathIndex];\n\t\t\tpathIndex++;\n\t\t}\n\t};\n\n\tcalculateLabelPosition = () => {\n\t\tconst found = this.findPathAndRelativePositionToRenderLabel(this.props.index + 1);\n\t\tif (!found) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst { path, position } = found;\n\n\t\tconst labelDimensions = {\n\t\t\twidth: this.ref.current.offsetWidth,\n\t\t\theight: this.ref.current.offsetHeight\n\t\t};\n\n\t\tconst pathCentre = path.getPointAtLength(position);\n\n\t\tconst labelCoordinates = {\n\t\t\tx: pathCentre.x - labelDimensions.width / 2 + this.props.label.getOptions().offsetX,\n\t\t\ty: pathCentre.y - labelDimensions.height / 2 + this.props.label.getOptions().offsetY\n\t\t};\n\n\t\tthis.ref.current.style.transform = `translate(${labelCoordinates.x}px, ${labelCoordinates.y}px)`;\n\t};\n\n\trender() {\n\t\tconst canvas = this.props.engine.getCanvas();\n\t\treturn (\n\t\t\t<S.Foreign key={this.props.label.getID()} width={canvas.offsetWidth} height={canvas.offsetHeight}>\n\t\t\t\t<S.Label ref={this.ref}>\n\t\t\t\t\t{this.props.engine.getFactoryForLabel(this.props.label).generateReactWidget({ model: this.props.label })}\n\t\t\t\t</S.Label>\n\t\t\t</S.Foreign>\n\t\t);\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}